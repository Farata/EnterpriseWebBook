<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Asciidoctor 0.1.4">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using AJAX and JSON</title>
<style>
@import url(http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.0/css/font-awesome.css);
@import url(http://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic);
/* normalize.css v2.1.1 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }
/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }
/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }
/** Address styling not present in IE 8/9. */
[hidden] { display: none; }
/* ========================================================================== Base ========================================================================== */
/** 1. Prevent system color scheme's background color being used in Firefox, IE, and Opera. 2. Prevent system color scheme's text color being used in Firefox, IE, and Opera. 3. Set default font family to sans-serif. 4. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { background: #fff; /* 1 */ color: #000; /* 2 */ font-family: sans-serif; /* 3 */ -ms-text-size-adjust: 100%; /* 4 */ -webkit-text-size-adjust: 100%; /* 4 */ }
/** Remove default margin. */
body { margin: 0; }
/* ========================================================================== Links ========================================================================== */
/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }
/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }
/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }
/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }
/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }
/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }
/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }
/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }
/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }
/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }
/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }
/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }
/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }
/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }
/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }
/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }
/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }
/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }
/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }
/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }
/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }
/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }
/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }
/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }
/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }
/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }
/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }
/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }
/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }
*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
html, body { font-size: 100%; }
body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }
a:hover { cursor: pointer; }
a:focus { outline: none; }
img, object, embed { max-width: 100%; height: auto; }
object, embed { height: 100%; }
img { -ms-interpolation-mode: bicubic; }
#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }
.left { float: left !important; }
.right { float: right !important; }
.text-left { text-align: left !important; }
.text-right { text-align: right !important; }
.text-center { text-align: center !important; }
.text-justify { text-align: justify !important; }
.hide { display: none; }
.antialiased, body { -webkit-font-smoothing: antialiased; }
img { display: inline-block; vertical-align: middle; }
textarea { height: auto; min-height: 50px; }
select { width: 100%; }
/* Grid HTML Classes */
.row { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; }
.row:before, .row:after { content: " "; display: table; }
.row:after { clear: both; }
.row.collapse .column, .row.collapse .columns { position: relative; padding-left: 0; padding-right: 0; float: left; }
.row .row { width: auto; margin-left: -0.9375em; margin-right: -0.9375em; margin-top: 0; margin-bottom: 0; max-width: none; *zoom: 1; }
.row .row:before, .row .row:after { content: " "; display: table; }
.row .row:after { clear: both; }
.row .row.collapse { width: auto; margin: 0; max-width: none; *zoom: 1; }
.row .row.collapse:before, .row .row.collapse:after { content: " "; display: table; }
.row .row.collapse:after { clear: both; }
.column, .columns { position: relative; padding-left: 0.9375em; padding-right: 0.9375em; width: 100%; float: left; }
@media only screen { .column, .columns { position: relative; padding-left: 0.9375em; padding-right: 0.9375em; float: left; }
  .small-1 { position: relative; width: 8.33333%; }
  .small-2 { position: relative; width: 16.66667%; }
  .small-3 { position: relative; width: 25%; }
  .small-4 { position: relative; width: 33.33333%; }
  .small-5 { position: relative; width: 41.66667%; }
  .small-6 { position: relative; width: 50%; }
  .small-7 { position: relative; width: 58.33333%; }
  .small-8 { position: relative; width: 66.66667%; }
  .small-9 { position: relative; width: 75%; }
  .small-10 { position: relative; width: 83.33333%; }
  .small-11 { position: relative; width: 91.66667%; }
  .small-12 { position: relative; width: 100%; }
  .small-offset-0 { position: relative; margin-left: 0%; }
  .small-offset-1 { position: relative; margin-left: 8.33333%; }
  .small-offset-2 { position: relative; margin-left: 16.66667%; }
  .small-offset-3 { position: relative; margin-left: 25%; }
  .small-offset-4 { position: relative; margin-left: 33.33333%; }
  .small-offset-5 { position: relative; margin-left: 41.66667%; }
  .small-offset-6 { position: relative; margin-left: 50%; }
  .small-offset-7 { position: relative; margin-left: 58.33333%; }
  .small-offset-8 { position: relative; margin-left: 66.66667%; }
  .small-offset-9 { position: relative; margin-left: 75%; }
  .small-offset-10 { position: relative; margin-left: 83.33333%; }
  [class*="column"] + [class*="column"]:last-child { float: right; }
  [class*="column"] + [class*="column"].end { float: left; }
  .column.small-centered, .columns.small-centered { position: relative; margin-left: auto; margin-right: auto; float: none !important; } }
/* Styles for screens that are atleast 768px; */
@media only screen and (min-width: 768px) { .large-1 { position: relative; width: 8.33333%; }
  .large-2 { position: relative; width: 16.66667%; }
  .large-3 { position: relative; width: 25%; }
  .large-4 { position: relative; width: 33.33333%; }
  .large-5 { position: relative; width: 41.66667%; }
  .large-6 { position: relative; width: 50%; }
  .large-7 { position: relative; width: 58.33333%; }
  .large-8 { position: relative; width: 66.66667%; }
  .large-9 { position: relative; width: 75%; }
  .large-10 { position: relative; width: 83.33333%; }
  .large-11 { position: relative; width: 91.66667%; }
  .large-12 { position: relative; width: 100%; }
  .row .large-offset-0 { position: relative; margin-left: 0%; }
  .row .large-offset-1 { position: relative; margin-left: 8.33333%; }
  .row .large-offset-2 { position: relative; margin-left: 16.66667%; }
  .row .large-offset-3 { position: relative; margin-left: 25%; }
  .row .large-offset-4 { position: relative; margin-left: 33.33333%; }
  .row .large-offset-5 { position: relative; margin-left: 41.66667%; }
  .row .large-offset-6 { position: relative; margin-left: 50%; }
  .row .large-offset-7 { position: relative; margin-left: 58.33333%; }
  .row .large-offset-8 { position: relative; margin-left: 66.66667%; }
  .row .large-offset-9 { position: relative; margin-left: 75%; }
  .row .large-offset-10 { position: relative; margin-left: 83.33333%; }
  .row .large-offset-11 { position: relative; margin-left: 91.66667%; }
  .push-1 { position: relative; left: 8.33333%; right: auto; }
  .pull-1 { position: relative; right: 8.33333%; left: auto; }
  .push-2 { position: relative; left: 16.66667%; right: auto; }
  .pull-2 { position: relative; right: 16.66667%; left: auto; }
  .push-3 { position: relative; left: 25%; right: auto; }
  .pull-3 { position: relative; right: 25%; left: auto; }
  .push-4 { position: relative; left: 33.33333%; right: auto; }
  .pull-4 { position: relative; right: 33.33333%; left: auto; }
  .push-5 { position: relative; left: 41.66667%; right: auto; }
  .pull-5 { position: relative; right: 41.66667%; left: auto; }
  .push-6 { position: relative; left: 50%; right: auto; }
  .pull-6 { position: relative; right: 50%; left: auto; }
  .push-7 { position: relative; left: 58.33333%; right: auto; }
  .pull-7 { position: relative; right: 58.33333%; left: auto; }
  .push-8 { position: relative; left: 66.66667%; right: auto; }
  .pull-8 { position: relative; right: 66.66667%; left: auto; }
  .push-9 { position: relative; left: 75%; right: auto; }
  .pull-9 { position: relative; right: 75%; left: auto; }
  .push-10 { position: relative; left: 83.33333%; right: auto; }
  .pull-10 { position: relative; right: 83.33333%; left: auto; }
  .push-11 { position: relative; left: 91.66667%; right: auto; }
  .pull-11 { position: relative; right: 91.66667%; left: auto; }
  .column.large-centered, .columns.large-centered { position: relative; margin-left: auto; margin-right: auto; float: none !important; }
  .column.large-uncentered, .columns.large-uncentered { margin-left: 0; margin-right: 0; float: left !important; }
  .column.large-uncentered.opposite, .columns.large-uncentered.opposite { float: right !important; } }
/* Image Thumbnails */
.th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.2); box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.2); -webkit-transition: all 200ms ease-out; -moz-transition: all 200ms ease-out; transition: all 200ms ease-out; }
.th:hover, .th:focus { -webkit-box-shadow: 0 0 6px 1px rgba(43, 166, 203, 0.5); box-shadow: 0 0 6px 1px rgba(43, 166, 203, 0.5); }
.th.radius { -webkit-border-radius: 3px; border-radius: 3px; }
a.th { display: inline-block; }
button, .button { border-style: solid; border-width: 1px; cursor: pointer; font-family: inherit; font-weight: bold; line-height: 1; margin: 0 0 1.25em; position: relative; text-decoration: none; text-align: center; display: inline-block; padding-top: 0.75em; padding-right: 1.5em; padding-bottom: 0.8125em; padding-left: 1.5em; font-size: 1em; background-color: #2ba6cb; border-color: #2284a1; color: white; }
button:hover, button:focus, .button:hover, .button:focus { background-color: #2284a1; }
button:hover, button:focus, .button:hover, .button:focus { color: white; }
button.secondary, .button.secondary { background-color: #e9e9e9; border-color: #d0d0d0; color: #333333; }
button.secondary:hover, button.secondary:focus, .button.secondary:hover, .button.secondary:focus { background-color: #d0d0d0; }
button.secondary:hover, button.secondary:focus, .button.secondary:hover, .button.secondary:focus { color: #333333; }
button.success, .button.success { background-color: #5da423; border-color: #457a1a; color: white; }
button.success:hover, button.success:focus, .button.success:hover, .button.success:focus { background-color: #457a1a; }
button.success:hover, button.success:focus, .button.success:hover, .button.success:focus { color: white; }
button.alert, .button.alert { background-color: #c60f13; border-color: #970b0e; color: white; }
button.alert:hover, button.alert:focus, .button.alert:hover, .button.alert:focus { background-color: #970b0e; }
button.alert:hover, button.alert:focus, .button.alert:hover, .button.alert:focus { color: white; }
button.large, .button.large { padding-top: 1em; padding-right: 2em; padding-bottom: 1.0625em; padding-left: 2em; font-size: 1.25em; }
button.small, .button.small { padding-top: 0.5625em; padding-right: 1.125em; padding-bottom: 0.625em; padding-left: 1.125em; font-size: 0.8125em; }
button.tiny, .button.tiny { padding-top: 0.4375em; padding-right: 0.875em; padding-bottom: 0.5em; padding-left: 0.875em; font-size: 0.6875em; }
button.expand, .button.expand { padding-right: 0px; padding-left: 0px; width: 100%; }
button.left-align, .button.left-align { text-align: left; text-indent: 0.75em; }
button.right-align, .button.right-align { text-align: right; padding-right: 0.75em; }
button.disabled, button[disabled], .button.disabled, .button[disabled] { background-color: #2ba6cb; border-color: #2284a1; color: white; cursor: auto; opacity: 0.6; -webkit-box-shadow: none; box-shadow: none; }
button.disabled:hover, button.disabled:focus, button[disabled]:hover, button[disabled]:focus, .button.disabled:hover, .button.disabled:focus, .button[disabled]:hover, .button[disabled]:focus { background-color: #2284a1; }
button.disabled:hover, button.disabled:focus, button[disabled]:hover, button[disabled]:focus, .button.disabled:hover, .button.disabled:focus, .button[disabled]:hover, .button[disabled]:focus { color: white; }
button.disabled:hover, button.disabled:focus, button[disabled]:hover, button[disabled]:focus, .button.disabled:hover, .button.disabled:focus, .button[disabled]:hover, .button[disabled]:focus { background-color: #2ba6cb; }
button.disabled.secondary, button[disabled].secondary, .button.disabled.secondary, .button[disabled].secondary { background-color: #e9e9e9; border-color: #d0d0d0; color: #333333; cursor: auto; opacity: 0.6; -webkit-box-shadow: none; box-shadow: none; }
button.disabled.secondary:hover, button.disabled.secondary:focus, button[disabled].secondary:hover, button[disabled].secondary:focus, .button.disabled.secondary:hover, .button.disabled.secondary:focus, .button[disabled].secondary:hover, .button[disabled].secondary:focus { background-color: #d0d0d0; }
button.disabled.secondary:hover, button.disabled.secondary:focus, button[disabled].secondary:hover, button[disabled].secondary:focus, .button.disabled.secondary:hover, .button.disabled.secondary:focus, .button[disabled].secondary:hover, .button[disabled].secondary:focus { color: #333333; }
button.disabled.secondary:hover, button.disabled.secondary:focus, button[disabled].secondary:hover, button[disabled].secondary:focus, .button.disabled.secondary:hover, .button.disabled.secondary:focus, .button[disabled].secondary:hover, .button[disabled].secondary:focus { background-color: #e9e9e9; }
button.disabled.success, button[disabled].success, .button.disabled.success, .button[disabled].success { background-color: #5da423; border-color: #457a1a; color: white; cursor: auto; opacity: 0.6; -webkit-box-shadow: none; box-shadow: none; }
button.disabled.success:hover, button.disabled.success:focus, button[disabled].success:hover, button[disabled].success:focus, .button.disabled.success:hover, .button.disabled.success:focus, .button[disabled].success:hover, .button[disabled].success:focus { background-color: #457a1a; }
button.disabled.success:hover, button.disabled.success:focus, button[disabled].success:hover, button[disabled].success:focus, .button.disabled.success:hover, .button.disabled.success:focus, .button[disabled].success:hover, .button[disabled].success:focus { color: white; }
button.disabled.success:hover, button.disabled.success:focus, button[disabled].success:hover, button[disabled].success:focus, .button.disabled.success:hover, .button.disabled.success:focus, .button[disabled].success:hover, .button[disabled].success:focus { background-color: #5da423; }
button.disabled.alert, button[disabled].alert, .button.disabled.alert, .button[disabled].alert { background-color: #c60f13; border-color: #970b0e; color: white; cursor: auto; opacity: 0.6; -webkit-box-shadow: none; box-shadow: none; }
button.disabled.alert:hover, button.disabled.alert:focus, button[disabled].alert:hover, button[disabled].alert:focus, .button.disabled.alert:hover, .button.disabled.alert:focus, .button[disabled].alert:hover, .button[disabled].alert:focus { background-color: #970b0e; }
button.disabled.alert:hover, button.disabled.alert:focus, button[disabled].alert:hover, button[disabled].alert:focus, .button.disabled.alert:hover, .button.disabled.alert:focus, .button[disabled].alert:hover, .button[disabled].alert:focus { color: white; }
button.disabled.alert:hover, button.disabled.alert:focus, button[disabled].alert:hover, button[disabled].alert:focus, .button.disabled.alert:hover, .button.disabled.alert:focus, .button[disabled].alert:hover, .button[disabled].alert:focus { background-color: #c60f13; }
button, .button { padding-top: 0.8125em; padding-bottom: 0.75em; -webkit-appearance: none; }
button.tiny, .button.tiny { padding-top: 0.5em; padding-bottom: 0.4375em; -webkit-appearance: none; }
button.small, .button.small { padding-top: 0.625em; padding-bottom: 0.5625em; -webkit-appearance: none; }
button.large, .button.large { padding-top: 1.03125em; padding-bottom: 1.03125em; -webkit-appearance: none; }
@media only screen { button, .button { -webkit-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.5) inset; box-shadow: 0 1px 0 rgba(255, 255, 255, 0.5) inset; -webkit-transition: background-color 300ms ease-out; -moz-transition: background-color 300ms ease-out; transition: background-color 300ms ease-out; }
  button:active, .button:active { -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2) inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2) inset; }
  button.radius, .button.radius { -webkit-border-radius: 3px; border-radius: 3px; }
  button.round, .button.round { -webkit-border-radius: 1000px; border-radius: 1000px; } }
@media only screen and (min-width: 768px) { button, .button { display: inline-block; } }
p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }
.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #003b6b; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }
/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }
/* Default Link Styles */
a { color: #00579e; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #333333; }
a img { border: none; }
/* Default paragraph styles */
p { font-family: "Droid Serif", Georgia, "Times New Roman", Times, serif; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }
/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Droid Serif", Georgia, "Times New Roman", Times, serif; font-weight: normal; font-style: normal; color: #7b2d00; text-rendering: optimizeLegibility; margin-top: 0.5em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #ff6b15; line-height: 0; }
h1 { font-size: 2.125em; }
h2 { font-size: 1.6875em; }
h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }
h4 { font-size: 1.125em; }
h5 { font-size: 1.125em; }
h6 { font-size: 1em; }
hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }
/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }
strong, b { font-weight: bold; line-height: inherit; }
small { font-size: 60%; line-height: inherit; }
code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; color: #003426; }
/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; list-style-position: outside; font-family: "Droid Serif", Georgia, "Times New Roman", Times, serif; }
ul, ol { margin-left: 1.5em; }
/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }
/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }
/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }
/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: black; border-bottom: 1px dotted #dddddd; cursor: help; }
abbr { text-transform: none; }
/* Blockquotes */
blockquote { margin: 0 0 0.75em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #e15200; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #e15200; }
blockquote, blockquote p { line-height: 1.6; color: #333333; }
/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }
.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }
@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Print styles.  Inlined to avoid required HTTP connection: www.phpied.com/delay-loading-your-print-css/ Credit to Paul Irish and HTML5 Boilerplate (html5boilerplate.com)
*/
.print-only { display: none !important; }
@media print { * { background: transparent !important; color: #000 !important; /* Black prints faster: h5bp.com/s */ box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; /* h5bp.com/t */ }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #d8d8ce; }
table thead, table tfoot { background: -webkit-linear-gradient(top, #add386, #90b66a); font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: white; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #6d6e71; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #edf2f2; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }
a:hover, a:focus { text-decoration: underline; }
.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }
*:not(pre) > code { font-size: inherit; padding: 3px 2px 1px 2px; white-space: nowrap; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; text-shadow: none; }
pre, pre > code { line-height: 1.6; color: black; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }
kbd.keyseq { color: #333333; }
kbd:not(.keyseq) { display: inline-block; color: black; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }
kbd kbd:first-child { margin-left: 0; }
kbd kbd:last-child { margin-right: 0; }
.menuseq, .menu { color: black; }
#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 1.5em; padding-right: 1.5em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }
#header { margin-bottom: 2.5em; }
#header > h1 { color: #7b2d00; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #333333; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }
#toc { border-bottom: 1px solid #dddddd; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }
#toctitle { color: #003b6b; }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; }
  #toc.toc2 { position: fixed; width: 20em; left: 0; top: 0; border-right: 1px solid #dddddd; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; }
  #toc.toc2 > ul { font-size: .95em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; border-width: 0; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }
#content #toctitle { font-weight: bold; font-family: "Droid Serif", Georgia, "Times New Roman", Times, serif; font-size: 1em; padding-left: 0.125em; }
#footer { max-width: 100%; background-color: none; padding: 1.25em; }
#footer-text { color: black; line-height: 1.44; }
.sect1 { padding-bottom: 1.25em; }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }
#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #7b2d00; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #622400; }
.imageblock, .literalblock, .listingblock, .verseblock, .videoblock { margin-bottom: 1.25em; }
.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }
.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }
table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }
.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #333333; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }
.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #aaaaaa; box-shadow: 0 1px 8px #aaaaaa; }
.sidebarblock { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #003b6b; margin-top: 0; line-height: 1.6; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }
.literalblock > .content pre, .listingblock > .content pre { background: #eeeeee; border-width: 1px; border-style: dashed; border-color: #666666; -webkit-border-radius: 0; border-radius: 0; padding: 1.25em 1.5625em 1.125em 1.5625em; word-wrap: break-word; }
.literalblock > .content pre.nowrap, .listingblock > .content pre.nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock > .content pre > code, .listingblock > .content pre > code { display: block; }
@media only screen { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.72em; } }
@media only screen and (min-width: 768px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.81em; } }
@media only screen and (min-width: 1280px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.9em; } }
.listingblock > .content { position: relative; }
.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }
.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }
.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }
.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }
table.pyhltable { border: 0; margin-bottom: 0; }
table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }
table.pyhltable td.code { padding-left: .75em; padding-right: 0; }
.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }
.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }
table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }
.quoteblock { margin: 0 0 0.75em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 0.75em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: 0.8125em; color: #e15200; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }
table thead th, table tfoot th { font-weight: bold; }
table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 0; border-radius: 0; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }
table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }
table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }
table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child { margin-bottom: 0; }
th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }
th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }
th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }
th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }
th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }
th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }
p.tableblock.header { color: white; font-weight: bold; }
td > div.verse { white-space: pre; }
ol { margin-left: 1.75em; }
ul li ol { margin-left: 1.5em; }
dl dd { margin-left: 1.125em; }
dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }
ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.375em; }
ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }
ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }
ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }
ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }
ul.inline { margin: 0 auto 0.375em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }
.unstyled dl dt { font-weight: normal; font-style: normal; }
ol.arabic { list-style-type: decimal; }
ol.decimal { list-style-type: decimal-leading-zero; }
ol.loweralpha { list-style-type: lower-alpha; }
ol.upperalpha { list-style-type: upper-alpha; }
ol.lowerroman { list-style-type: lower-roman; }
ol.upperroman { list-style-type: upper-roman; }
ol.lowergreek { list-style-type: lower-greek; }
.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }
td.hdlist1 { padding-right: .8em; font-weight: bold; }
td.hdlist1, td.hdlist2 { vertical-align: top; }
.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }
.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }
.qanda > ol > li > p > em:only-child { color: #004985; }
.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.2); box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.2); }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }
.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }
a.image { text-decoration: none; }
span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }
.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }
div.unbreakable { page-break-inside: avoid; }
.big { font-size: larger; }
.small { font-size: smaller; }
.underline { text-decoration: underline; }
.overline { text-decoration: overline; }
.line-through { text-decoration: line-through; }
.aqua { color: #00bfbf; }
.aqua-background { background-color: #00fafa; }
.black { color: black; }
.black-background { background-color: black; }
.blue { color: #0000bf; }
.blue-background { background-color: #0000fa; }
.fuchsia { color: #bf00bf; }
.fuchsia-background { background-color: #fa00fa; }
.gray { color: #606060; }
.gray-background { background-color: #7d7d7d; }
.green { color: #006000; }
.green-background { background-color: #007d00; }
.lime { color: #00bf00; }
.lime-background { background-color: #00fa00; }
.maroon { color: #600000; }
.maroon-background { background-color: #7d0000; }
.navy { color: #000060; }
.navy-background { background-color: #00007d; }
.olive { color: #606000; }
.olive-background { background-color: #7d7d00; }
.purple { color: #600060; }
.purple-background { background-color: #7d007d; }
.red { color: #bf0000; }
.red-background { background-color: #fa0000; }
.silver { color: #909090; }
.silver-background { background-color: #bcbcbc; }
.teal { color: #006060; }
.teal-background { background-color: #007d7d; }
.white { color: #bfbfbf; }
.white-background { background-color: #fafafa; }
.yellow { color: #bfbf00; }
.yellow-background { background-color: #fafa00; }
span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }
.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #00579e; color: #004176; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }
.conum { display: inline-block; color: white !important; background-color: black; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
body { font-family: "Droid Serif", Georgia, "Times New Roman", Times, serif; font-size: 16px; color: #111; }
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { border-bottom: 1px solid #dddddd; }
#toctitle { color: #00406F; font-weight: normal; margin-top: 1.5em; }
.sidebarblock { border-color: #aaa; }
code { -webkit-border-radius: 4px; border-radius: 4px; }
p.tableblock.header { color: #6d6e71; }
</style>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/styles/default.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</head>
<body class="book toc2 toc-right">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_using-ajax-and-json">Using AJAX and JSON</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_what-s-ajax">What&#8217;s AJAX</a></li>
<li><a href="#_what-s-json">What&#8217;s JSON</a></li>
<li><a href="#_how-ajax-works">How AJAX Works</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_retrieving-data-from-the-server">Retrieving Data From the Server</a></li>
<li><a href="#_ajax-good-and-bad">AJAX: Good and Bad</a></li>
<li><a href="#_populating-states-and-countries-from-html-files">Populating States and Countries from HTML Files</a></li>
</ul>
</li>
<li><a href="#_using-json">Using JSON</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_populating-states-and-countries-from-json-files">Populating States and Countries from JSON Files</a></li>
<li><a href="#_arrays-in-json">Arrays in JSON</a></li>
<li><a href="#_loading-charity-events-using-ajax-and-json">Loading Charity Events using AJAX and JSON</a></li>
<li><a href="#_json-in-cms">JSON in CMS</a></li>
</ul>
</li>
<li><a href="#_json-in-java">JSON in Java</a></li>
<li><a href="#_compressing-json">Compressing JSON</a></li>
<li><a href="#_adding-charts-to-save-the-child">Adding Charts to Save The Child</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_adding-chart-with-canvas-element">Adding Chart With Canvas Element</a></li>
<li><a href="#_adding-chart-with-svg">Adding Chart With SVG</a></li>
</ul>
</li>
<li><a href="#_what-is-jsonp">What is JSONP</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_beer-and-jsonp">Beer and JSONP</a></li>
</ul>
</li>
<li><a href="#_summary">Summary</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_using-ajax-and-json"><a class="anchor" href="#_using-ajax-and-json"></a>Using AJAX and JSON</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter is about bringing the external data to HTML Web pages. In the previous chapters we&#8217;ve been using only hard-coded data - our goal was to see how to layout the Web page and how to change the layout in case some events have happened, e.g. the user clicked on the menu button. Now we&#8217;ll make sure that our single-page application Save The Child can request the data from the external sources and send them the data too. This comes down to two questions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>How can an HTML Web page exchange the data with external data sources?</p>
</li>
<li>
<p>What format to use for presenting the application data?</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>While there could be different answers to these questions, we&#8217;ll be using AJAX techniques as an answer to the first question and JSON data format as an answer to the second one. We&#8217;ll start this chapter with explaining why AJAX and JSON are appropriate choice for the Save The Child Web application and many others.</p>
</div>
<div class="sect2">
<h3 id="_what-s-ajax"><a class="anchor" href="#_what-s-ajax"></a>What&#8217;s AJAX</h3>
<div class="paragraph">
<p>In the early days of the Internet, every new page, whether on the same or separate web site, required a new request and response to the web server. This, in turn, would re-render the entire contents of the new page. If a user points her Web browser to one URL and then changes it to another, the new request will be sent to the new URL, and the new page will arrive and will be rendered by the browser. The URL may have been changed not because the user decided to go to visit a different Web site, but simply because the user selected a menu item that resulted in bringing a new Web page from the same domain. This was pretty much the only way to design Web sites in the 90th.</p>
</div>
<div class="paragraph">
<p>Back in 1999, Microsoft decided to create a Web version of Outlook - their popular eMail application. Their goal was to be able to modify the Input folder as the new emails arrive, but without refreshing the entire content of the Web page. They created an ActiveX control called <code>XMLHTTP</code> that lived inside Internet Explorer 5 and could make requests to the remote servers receiving data without the need to refresh the entire Web page. Such a Web Outlook client would would make periodic requests to the mail server, and if the new mail arrived the application would insert the new row on the top of the Inbox by direct change of the DOM object from JavaScript.</p>
</div>
<div class="paragraph">
<p>In early 2000th, other Web browsers adopted this model and implemented their own versions of <code>XMLHTTPRequest</code>. Its Working Draft 6 is <a href="http://www.w3.org/TR/XMLHttpRequest/">published by W3C</a>.  Google created their famous email client GMail and Map Web applications.  In 2005 Jesse James Garrett wrote an article titled "AJAX: A New Approach to Web Applications". The Web developer community liked the term AJAX, which stand for Asynchronous JavaScript and XML, and this gave a birth to the new breed of Web applications that could update the content of just the portion of a Web page without re-retrieving the entire page. Interestingly enough, the last letter in the AJAX acronym stands for XML, while realistically presenting the data in the XML form is not required, and currently is seldom used as a data format in the client-server exchanges. JSON is used a lot more often to represent the data, but apparently AJAJ didn&#8217;t sound as good as AJAX.</p>
</div>
<div class="paragraph">
<p>Visit the <a href="http://www.google.com/finance">Google Finance</a> or <a href="http://finance.yahoo.com/">Yahoo! Finance</a> Web pages when the stock market is open, and you&#8217;ll see how the price quotes or other financial indicators are changing while the most of the content remains the same. This gives an illusion of the server pushing the data to your Web client. But most likely, it not a data push but rather periodic <em>polling</em> of the server&#8217;s data using AJAX. In the modern Web applications we expect to see more of the real server side data push using HTML5 WebSockets API, which is described in details in Chapter 9 of this book.</p>
</div>
</div>
<div class="sect2">
<h3 id="_what-s-json"><a class="anchor" href="#_what-s-json"></a>What&#8217;s JSON</h3>
<div class="paragraph">
<p><a href="http://www.json.org/js.html">JSON</a> stands for JavaScript Object Notation. It&#8217;s a more compact than XML way to represent the data. Besides, all modern Web Browsers understand and can parse JSON data. After learning the JavaScript object literals in Chapter 1, you&#8217;ll see that the presenting the data in JSON notation is almost the same as writing JavaScript object literals.</p>
</div>
<div class="paragraph">
<p><a href="#FIG4-1">Anatomy of a Web application</a> depicts a high level view of a typical Web application. All of the code samples from Chapter 1 (and in Appendixes) were where written in HTML, JavaScript and CSS. In this chapter will add to the mix the <code>XMLHttpRequest</code> object that will send and receive the JSON content wrapped into <code>HTTPRequest</code> and <code>HTTPResponse</code> objects.</p>
</div>
<div id="FIG4-1" class="imageblock">
<div class="content">
<img src="images/fig_04_01.png" alt="fig 04 01">
</div>
<div class="title">Figure 1. Anatomy of a Web application</div>
</div>
<div class="paragraph">
<p>When a Web page is loaded the user doesn&#8217;t know (and doesn&#8217;t have to know) that the page content was brought from several servers that can be located thousands miles apart. More often than not, when the user enters the URL requesting an HTML document, the server side code can engage several servers to bring all the data requested by the user. Some of the data are retrieved by making calls to one or more Web Services. The legacy Web services were build using SOAP + XML, but  majority of today&#8217;s Web services are build using lighter <a href="http://en.wikipedia.org/wiki/Representational_state_transfer"><em>RESTful architecture</em></a>, and JSON has become a de facto standard data exchange format of the REST Web services.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how-ajax-works"><a class="anchor" href="#_how-ajax-works"></a>How AJAX Works</h3>
<div class="paragraph">
<p>Imagine a single-page application that needs some data to refreshed in real time. For example, our Save The Child application includes an online auction where people can bid and purchase some goods as a part of a charity event. If John from New York placed a bid on certain auction item, and some time later Mary from Chicago placed the higher bid on the same item, we want to make sure that John knows about it immediately, in real time.  This means that the server-side software that received Mary&#8217;s bid has to push this data to all users who expressed their interest in the same item.</p>
</div>
<div class="paragraph">
<p>But the server has to send and the browser has to modify only the new price while the rest of the content of the Web page should remain the same. You can implement behavior using AJAX. But first, the bad news: you can&#8217;t implement the real-time server side push with AJAX. You can only emulate this behavior by using polling techniques, when the <code>XMLHttpRequest</code> object sits inside your JavaScript code and periodically sends HTTP requests to the server asking if there were any changes in bids since the last request.</p>
</div>
<div class="paragraph">
<p>If, for instance, the last request was made at 10:20:00AM, the new bid was placed at 10:20:02AM, and the application makes a new request (and updates the browser&#8217;s window) at 10:20:25AM, this means that the user will be notified about the price change with a three second delay. AJAX is still request-response based way of getting the server&#8217;s data, and strictly speaking, doesn&#8217;t offer a real real-time updates. Some people use the term <em>near real time</em> notifications.</p>
</div>
<div class="paragraph">
<p>Another bad news is that AJAX uses HTTP protocol for the data communication, which means that a substantial overhead in the form of <code>HTTPResponse</code> header will be added to the new price, and it can be as large as several hundred bytes. This is still better than sending the entire page to the Web browser, but HTTP adds a hefty overhead.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
We&#8217;ll implement such an auction in Chapter 8 using a lot more efficient protocol called WebSockets, which supports a real-time data push and adds only several extra bytes to the data load.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_retrieving-data-from-the-server"><a class="anchor" href="#_retrieving-data-from-the-server"></a>Retrieving Data From the Server</h4>
<div class="paragraph">
<p>Let&#8217;s try to implement AJAX techniques by implementing a data retrieval. The process of making an AJAX request is well defined and consists of the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create an instance of XMLHttpRequest object.</p>
</li>
<li>
<p>Initialize the request to your data source by invoking the method <code>open()</code>.</p>
</li>
<li>
<p>Assign the a handler to the <code>onreadystatechange</code> attribute to process server&#8217;s response.</p>
</li>
<li>
<p>Make a non-blocking request to the data source by calling <code>send()</code>.</p>
</li>
<li>
<p>In your handler function process the response when it arrives from the server. This is were  <em>asynchronous</em> came from - the handler can be invoked at any time whenever the server prepares the response.</p>
</li>
<li>
<p>Modify the DOM elements based on the received data, if need be.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In most of the books on AJAX you&#8217;ll see browser-specific ways of instantiating the <code>XMLHttpRequest</code> object (a.k.a. XHR). Most likely you&#8217;ll be developing your application using some JavaScript library or a framework and all browser specifics in instantiating of the <code>XMLHttpRequest</code> will be hidden from you. Chapters 3 and 4 include such examples, but let&#8217;s stick to the standard JavaScript way implemented by all modern browsers:</p>
</div>
<div class="paragraph">
<p><code>var xhr = new XMLHttpRequest();</code></p>
</div>
<div class="paragraph">
<p>The next step is to initialize a request by invoking the method <code>open()</code>. You need to provide the HTTP method (<code>GET</code>, <code>POST</code> et al.), the URL of the data source. Optionally, you can provide three more arguments: a Boolean variable indicating if you want this request to be processed asynchronously (which is the default), and the user id and password if the authentication is required. Keep in mind, that the following method does not request the data yet.</p>
</div>
<div class="paragraph">
<p><code>xhr.open('GET', dataUrl);</code></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Always use HTTPS protocol if you need to send the user id and password. Using secure HTTP should be your preferred protocol in general (read more in Chapter 9).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>XHR has an attribute <code>readyState</code>, and as soon as it changes the callback function assigned to the <code>onreadystatechange</code> will be invoked. This callback should contain your application specific code to analyze the response and process it accordingly. Assigning such a callback is pretty simple:</p>
</div>
<div class="paragraph">
<p><code>xhr.onreadystatechange = function(){...}</code></p>
</div>
<div class="paragraph">
<p>Inside such a callback function you&#8217;ll be analyzing the value of the XHR&#8217;s attribute <code>readyState</code>, which can have one of the following values:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:80%; ">
<caption class="title">Table 1. States of the Request</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">State</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNSENT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the XHR has been constructed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPENED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">open() was successfully invoked</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HEADERS_RECEIVED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All HTTP headers has been received</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOADING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The response body is being received</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the data transfer has been completed</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Finally, send the AJAX request for data. The method <code>send()</code> can be called with or without parameters depending on if you need to send the data to the server or not. In its simplest fore the method <code>send()</code> can be invoked as follows:</p>
</div>
<div class="paragraph">
<p><code>xhr.send();</code></p>
</div>
<div class="paragraph">
<p>The complete cycle of the <code>readyState</code> transitions is depicted in <a href="#FIG4-2">Transitions of the readyState attribute</a></p>
</div>
<div id="FIG4-2" class="imageblock">
<div class="content">
<img src="images/fig_04_02.png" alt="fig 04 02">
</div>
<div class="title">Figure 2. Transitions of the readyState attribute</div>
</div>
<div class="paragraph">
<p>Let&#8217;s spend a bit more time discussing the completion of the this cycle when server&#8217;s response is received and the XHR&#8217;s <code>readyState</code> is equal to 4. This means that we&#8217;ve got something back, which can be either the data we&#8217;ve expected or the error message. We need to handle both scenarios in the function assigned to the <code>onreadystatechange</code> attribute. This is a common way to do it in JavaScript without using frameworks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">xhr.onreadystatechange = function(){

 if (xhr.readyState == 4) {

   if((xhr.status &gt;=200 &amp;&amp; xhr.status &lt;300) || xhr.status===304) {

       // We got the data. Get the value from one of the response attributes
       // e.g. xhr.responseText and process the data accordingly.

   } else {
      // We got an error. Process the error code and
      // display the content of the statusText attribute.
   }

  }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>One note about the third line of the code above. Here we&#8217;re checking the <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">HTTP status code</a> received from server. W3C splits the HTTP codes into groups. The codes numbered as 1xx are informational, 2xx are successful codes, 3xx are about redirections, 4xx represent bad requests (like infamous 404 for Not Found), and 5xx for server errors. That&#8217;s why the above code fragment checks for all 2xx codes and 304 - the data was not modified and taken from cache.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your application needs to post the data to the server, you need to open the connection to the server with the <code>POST</code> parameter. You&#8217;ll also need to set the HTTP header attribute <code>Content-type</code> to either <code>multipart/form-data</code> for large-size binary data or to  <code>application/x-www-form-urlencoded</code> (for forms and small-size alphanumeric data).  Then prepare the data object and invoke the method <code>send()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">var data="This is some data";
xhr.open('POST', dataUrl, true);
xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

...
xhr.send(data);</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ajax-good-and-bad"><a class="anchor" href="#_ajax-good-and-bad"></a>AJAX: Good and Bad</h4>
<div class="paragraph">
<p>AJAX techniques have their pros and cons. You saw how easy it was to create a Web page that didn&#8217;t have to refresh itself, but provided the users with the means of communicating with the server. This certainly improves the user experience. The fact that AJAX allows you to lower the amount of data that goes over the wire is important too. Another important advantage of AJAX that it works in a standard HTML/JavaScript environment and is supported by all Web browsers. The JavaScript frameworks hides all the differences in instantiating <code>XMLHttpRequest</code> and simplify making HTTP requests and processing responses. Since the entire page is not reloaded, you can create "fat clients" that keep certain data preloaded once and reused in your JavaScript in different use cases. With AJAX you can lazy load some content as needed rather than loading everything at once. Taken for granted auto-completion feature would not be possible in HTML/JavaScript application without the AJAX.</p>
</div>
<div class="paragraph">
<p>On the bad side, with AJAX the user loses the functionality of the browser&#8217;s Back button, which reloads the previous Web page while the user could expect to see the previous state of the same page. Since the AJAX brings most of the content dynamically, the search engines wouldn&#8217;t rank your Web pages as high as it would do if the content was statically embedded in the HTML. Increasing the amount of AJAX interactions means that your application will have to send more of the JavaScript code to the Web browser, which increases the complexity of programming and decreases the scalability of your application.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Using HTML5 History API (see Chapter 1) will help you in teaching the old dog (the browser&#8217;s Back button) new tricks.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>AJAX applications are subject to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Same_origin_policy_for_JavaScript"><em>the same origin policy</em></a> (the same protocol, host name, and port) allowing <code>XMLHttpRequest</code> make HTTP requests only to the domains where the Web application was loaded from. It&#8217;s a security measure to limit the ability of JavaScript code to interact with resources that arrive to the Web browser from a different Web server.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
W3C has published a working draft of <a href="https://developer.mozilla.org/en-US/docs/HTTP/Access_control_CORS?redirectlocale=en-US&amp;redirectslug=HTTP_access_control">Cross-Origin Resource Sharing</a> (CORS) - a mechanism to enable client-side cross-origin requests.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_populating-states-and-countries-from-html-files"><a class="anchor" href="#_populating-states-and-countries-from-html-files"></a>Populating States and Countries from HTML Files</h4>
<div class="paragraph">
<p>To see the first example where we are using AJAX in our Save The Child application run the project-01-donation-ajax-html, where we&#8217;ve removed the hard-coded data about countries and states from HTML and saved them in two separate files: data/us-states.html and data/countries.html. In this project the file index.html has two empty comboboxes (<code>&lt;select&gt;</code> elements):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="html language-html">  &lt;select name="state" id="state"&gt;
    &lt;option value="" selected="selected"&gt; - State - &lt;/option&gt;
    &lt;!-- AJAX will load the rest of content --&gt;
  &lt;/select&gt;
  &lt;select name="country" id="counriesList"&gt;
    &lt;option value="" selected="selected"&gt; - Country - &lt;/option&gt;
    &lt;!-- AJAX will load the rest of content --&gt;
  &lt;/select&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting Save The Child page will look the same as the last sample from the previous chapter, but the Countries and States dropdowns are now populated be the data located in these files(later in this chapter in the section on JSON we&#8217;ll replace this HTML file with its JSON version). These are the first three lines (out of 241) from the file countries.html:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="html language-html">&lt;option value="United States"&gt;United States&lt;/option&gt;
&lt;option value="United Kingdom"&gt;United Kingdom&lt;/option&gt;
&lt;option value="Afghanistan"&gt;Afghanistan&lt;/option&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The JavaScript code that reads countries and states from file (text and HTML markup) and populates the dropdowns comes next. The content of these files is assigned to the <code>innerHTML</code> attribute of the given HTML <code>&lt;select&gt;</code> element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">function loadData(dataUrl, target) {
  var xhr = new XMLHttpRequest();
  xhr.open('GET', dataUrl, true);
  xhr.onreadystatechange = function() {
  	if (xhr.readyState == 4) {
           if((xhr.status &gt;=200 &amp;&amp; xhr.status &lt;300) ||
                                 xhr.status===304){

  			target.innerHTML += xhr.responseText;
  	  } else {

  			console.log(xhr.statusText);
  	  }
  	}
  }
  xhr.send();
}

// Load the countries and states using XHR
loadData('data/us-states.html', statesList);
loadData('data/countries.html', counriesList);</code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The above code has an issue, which may not be so obvious, but can irritate users. The problem is that it doesn&#8217;t handle errors. Yes, we print the error message on the developer&#8217;s console, but the end user will never see them. If for some reason the data about countries or states won&#8217;t arrive, the dropdowns will be empty, the donation form won&#8217;t be valid and the users will become angry that they can&#8217;t make a donation without knowing why. Proper error handling and reports are very important for any application so never ignore it. You should display a user-friendly error messages on the Web page. For example the above <code>else</code> statement can display the received message in the page footer
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>else {
	console.log(xhr.statusText);</p>
</div>
<div class="literalblock">
<div class="content">
<pre>	// Show the error message on the Web page
      footerContainer.innerHTML += '&lt;p class="error"&gt;Error getting ' +
                    target.name + ": "+ xhr.statusText + ",code: "+
                     xhr.status + "&lt;/p&gt;";
}</pre>
</div>
</div>
<div class="paragraph">
<p>This code uses the CSS selector <code>error</code> that will show the error message on the red background. you can find it in the file styles.css in the project-02-donation-error-ajax-html. It looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="css language-css">footer p.error {
	background:#d53630;
	text-align:left;
	padding: 0.9em;
	color: #fff;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following code fragment shows how to add the received data to a certain area on the Web page.
This code creates an HTML paragraph <code>&lt;p&gt;</code> with the text returned by the server and then adds this paragraph to the <code>&lt;div&gt;</code> with the ID <code>main</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">if (xhr.readyState == 4) {
  if((xhr.status &gt;=200 &amp;&amp; xhr.status &lt;300) || xhr.status===304){
      var p = document.createElement("p");

      p.appendChild(document.createTextNode(myRequest.responseText));

      document.getElementById("main").appendChild(p);
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using-json"><a class="anchor" href="#_using-json"></a>Using JSON</h3>
<div class="paragraph">
<p>In any client-server application one of the important decisions to be made is about the format of the data that go over the network. We are talking about the application-specific data. Someone has to decide how to represent the data about an Auction Item, Customer, Donation et al. The easiest way to represent text data is Comma Separated Format (CSV), but it&#8217;s not easily readable by humans, hard to validate,  and recreation of JavaScript objects from CSV feed would require additional information about the headers of the data.</p>
</div>
<div class="paragraph">
<p>Sending the data in XML form addresses the readability and validation issues, but it&#8217;s very verbose. Every data element has to be surrounded by an opening and closing tag describing the data. Converting the XML data to/from JavaScript object requires special parsers, and you&#8217;d need to use one of the JavaScript libraries for cross-browser compatibility.</p>
</div>
<div class="paragraph">
<p>Douglas Crockford popularized new data format, which is known as JSON. In today&#8217;s Web JSON became the most popular data format. It&#8217;s not as verbose as XML, and JSON&#8217;s notation is almost the same as JavaScript object literals. It&#8217;s easily readable by humans, and every ECMAScript 5 compliant browser includes a native JSON object: <code>window.JSON</code>. Even though the JSON formatted data look like JavaScript object literals, JSON is language independent. Here&#8217;s an example of the data in the JSON format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">{
 "fname":"Alex",
 "lname":"Smith",
 "age":30,
 "address": {
     "street":"123 Main St.",
     "city": "New York"}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Anyone who knows JavaScript understands that this is an object that represents a person, which has a nested object that represents an address. Note the difference with JavaScript literals: the names of the properties are always strings, and every string must be taken into quotes. Representing the same object in XML would need a lot more characters (e.g. <code>&lt;fname&gt;Alex&lt;/fname&gt;</code> etc).</p>
</div>
<div class="paragraph">
<p>There are some other important differences between JSON and XML. The structure of the XML document can be defined using DTD or XML Schema, which simplifies the data validation, but requires additional programming and schema maintenance. On the other hand, JSON data have data types, for example the <code>age</code> attribute in the above example is not only a <code>Number</code>, but will be further evaluated by the JavaScript engine and will be stored as an integer. JSON also supports arrays while XML doesn&#8217;t.</p>
</div>
<div class="paragraph">
<p>For parsing JSON in JavaScript you use the method <code>JSON.parse()</code>, which takes a string and returns JavaScript object, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">var customer=JSON.parse('{"fname":"Alex","lname":"Smith"}');

console.log(Your name is  + customer.fname +   + customer.lname);
</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a reverse operation - turning an object into JSON string - do <code>JSON.stringify(custormer)</code>. The older browsers didn&#8217;t have the <code>JSON</code> object, and there is an alternative way of parsing JSON is with the help of the script json2.js, which creates the JSON property on the global object. The json2.js is freely available on <a href="http://bit.ly/aUMLnL">Github</a>. In Chapter 3 you&#8217;ve learned about feature detection with Modernizr, and you can automate the loading of this script if needed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">Modernizr.load({
    test: window.JSON,
    nope: 'json2.js',
    complete: function () {
        var customer = JSON.parse('{"fname":"Alex","lname":"Smith"}');
    }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Usually, JSON-related articles and blogs are quick to remind you about the evil nature of the JavaScript function <code>eval()</code> that can take an arbitrary JavaScript code and execute it. The <code>JSON.parse()</code> is pictured as a protection against the malicious JavaScript that can be injected into your application&#8217;s code and then executed by <code>eval()</code> by the Web browser. The main argument is that <code>JSON.parse()</code> will not be processing the incoming code unless it contains valid JSON data.</p>
</div>
<div class="paragraph">
<p>Protecting your application code from being infected by means of <code>eval()</code> can be done outside of your application code. Replacing HTTP with secure HTTPS protocol helps a lot in this regard. Some Web applications  eliminate the possibility of cross-origin scripting by routing all requests to third-party data sources via proxying such requests through your trusted servers. But proxying all requests through your server may present scalability issues - imagine if thousands of concurrent users will be routed through your server - so do some serious load testing before making this architectural decision.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
There are several JSON tools useful for developers. To make sure that your JSON data is valid and properly formatted use <a href="http://jsonlint.com/">JSONLint</a>. If you paste an ugly one-line JSON data JSONLint will reformat it into a readable form. There is also an add-on JSONView, available both for <a href="https://addons.mozilla.org/en-US/firefox/addon/jsonview/">Firefox</a> and for <a href="https://chrome.google.com/webstore/detail/jsonview/chklaanhfefbnpoihckbnefhakgolnmc">Chrome</a> browsers.  With JSONView the JSON objects are displayed in a pretty formatted collapsible format. If there are errors in the JSON document they will be reported. At the time of this writing Chrome&#8217;s version of JSONView does a better job in  reporting errors.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_populating-states-and-countries-from-json-files"><a class="anchor" href="#_populating-states-and-countries-from-json-files"></a>Populating States and Countries from JSON Files</h4>
<div class="paragraph">
<p>Earlier in this chapter you&#8217;ve seen an example of populating states and countries in the donate form from HTML files. Now you&#8217;ll see how to retrieve the JSON data by making an AJAX call. Open in the Web browser the project-04-2-donation-ajax-json - it reads the countries and states from the files countries.json and us_states.json respectively. The beginning of the file countries.json is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">{
"countrieslist": [
	{
		"name": "Afghanistan",
		"code": "AF"
	}, {
		"name": "land Islands",
		"code": "AX"
	}, {
		"name": "Albania",
		"code": "AL"
	},</code></pre>
</div>
</div>
<div class="paragraph">
<p>The JavaScript code that populates the countries and states comboboxes comes next. Note the difference in creating the <code>&lt;option&gt;</code> tags from JSON vs. HTML.  In case of HTML, the received data were added to the <code>&lt;select&gt;</code> element as is: <code>target.innerHTML += xhr.responseText;</code> In JSON files the data were not wrapped in to the <code>&lt;option&gt;</code> tags,  hence it&#8217;s done programmatically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">function loadData(dataUrl, rootElement, target) {
  var xhr = new XMLHttpRequest();
  xhr.overrideMimeType("application/json");
  xhr.open('GET', dataUrl, true);

  xhr.onreadystatechange = function() {
    if (xhr.readyState == 4) {
      if (xhr.status == 200) {

        //parse jsoon data
        var jsonData = JSON.parse(xhr.responseText);

        var optionsHTML = ''
        for(var i= 0; i &lt; jsonData[rootElement].length; i++){
          optionsHTML+='&lt;option value="'+jsonData[rootElement][i].code+'"&gt;'
                     + jsonData[rootElement][i].name+'&lt;/option&gt;'
        }

        var targetCurrentHtml = target.innerHTML;
        target.innerHTML = targetCurrentHtml + optionsHTML;

      } else {
        console.log(xhr.statusText);

        // Show the error on the Web page
        tempContainer.innerHTML += '&lt;p class="error"&gt;Error getting ' +
          target.name + ": "+ xhr.statusText + ",code: "+ xhr.status + "&lt;/p&gt;";
      }
    }
  }
  xhr.send();
}

loadData('data/us-states.json', 'usstateslist', statesList);
loadData('data/countries.json', 'countrieslist', counriesList);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example we called the method <code>XMLHttpRequest.overrideMimeType()</code> to ensure that the data will be treated by the browser as JSON even if the server won&#8217;t report them as such.</p>
</div>
</div>
<div class="sect3">
<h4 id="_arrays-in-json"><a class="anchor" href="#_arrays-in-json"></a>Arrays in JSON</h4>
<div class="paragraph">
<p>JSON supports arrays, and the next example shows you how the information about a customer can be presented in JSON format. A customer can have more than one phone, which are stored in an array.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">&lt;script &gt;
   var customerJson = '{"fname":"Alex",
                        "lname":"Smith",
                        "phones":[
                            "212-555-1212",
                            "565-493-0909"
                        ]
                       }';

   var customer=JSON.parse(customerJson);

   console.log("Parsed customer data: fname=" + customer.fname +
                      " lname=" + customer.lname +
                      " home phone=" + customer.phones[0] +
                      " cell phone=" + customer.phones[1]);
&lt;/script&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above creates an instance of the JavaScript object referenced by the variable <code>customer</code>. In this example the <code>phones</code> array just holds two strings. But you can store object in JSON array the same way as you&#8217;d do it in JavaScript object literal - just don&#8217;t forget to put every property name in quotes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">var customerJson = '{"fname":"Alex",
                     "lname":"Smith",
                   "phones":[
                        {"type":"home", "number":"212-555-1212"},
                         {"type":"work","number":"565-493-0909"}]
                    }';</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_loading-charity-events-using-ajax-and-json"><a class="anchor" href="#_loading-charity-events-using-ajax-and-json"></a>Loading Charity Events using AJAX and JSON</h4>
<div class="paragraph">
<p>The last example in Chapter 1 was about displaying various charity events on the Google map using multiple markers. But the data about these events were hard-coded in HTML file. After getting familiar with AJAX and JSON it should not be too difficult to create a separate file with the information about charities in JSON format and load them using <code>XMLHTTPRequest</code> object.</p>
</div>
<div class="paragraph">
<p>The next version of Save The Child is a modified version of the application that displayed Google map with multiple markers from Chapter 1. But this time we&#8217;ll load the information about the charity events from the file campaigndata.json shown next.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">{
  "campaigns": {
    "header": "Nationwide Charity Events",
    "timestamp":"12/15/2012",
    "items": [
      {
        "title": "Lawyers for Children",
        "description":"Lawyers offering free services for The Children",
        "location":"New York,NY"
      },
      {
        "title": "Mothers of Asthmatics",
        "description":"Mothers of Asthmatics - nationwide Asthma network",
        "location": "Dallas,TX"
      },
      {
        "title": "Friends of Blind Kids",
        "description":"Semi-annual charity events for blind kids",
        "location":"Miami,FL"
      },
      {
        "title": "A Place Called Home",
        "description":"Adoption of The Children",
        "location":"Miami,FL"
      },
      {
        "title": "Marathon for Survivors",
        "description":"Annual marathon for cancer survivors",
        "location":"Fargo, ND"
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the project-03-maps-json-data and you&#8217;ll see the map with the markers for each of the events loaded from the file campaigndata.json (see <a href="#FIG4-03">Markers built from JSON data</a>). Click on the marker to see an overlay with the event details.</p>
</div>
<div id="FIG4-03" class="imageblock">
<div class="content">
<img src="images/fig_04_03.png" alt="fig 04 03">
</div>
<div class="title">Figure 3. Markers built from JSON data</div>
</div>
<div class="paragraph">
<p>Note that this JSON file contains the object <code>campaigns</code>, which includes the array of objects <code>items</code> representing charity events. <code>XMLHttpRequest</code> object loads the data and the <code>JSON</code> parses it assigning the <code>campaigns</code> object to the variable <code>campaignsData</code> that is used in <code>showCampaignsInfo()</code> with Google Maps API (we&#8217;ve omitted the mapping part for brevity).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">function showCampaignsInfo(campaigns) {

	campaignsCount = campaigns.items.length;

	var message = "&lt;h3&gt;" + campaigns.header + "&lt;/h3&gt;" +
	                      "On " + campaigns.timestamp +
	                " we run " + campaignsCount + " campaigns.";

    locationUI.innerHTML = message + locationUI.innerHTML;
	resizeMapLink.style.visibility = "visible";

	createCampaignsMap(campaigns);
}

function loadData(dataUrl) {
 var xhr = new XMLHttpRequest();
 xhr.open('GET', dataUrl);

 xhr.onreadystatechange = function() {
 	if (xhr.readyState == 4) {
          if ((xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) ||
                                    xhr.status === 304) {
 	 	var jsonData = xhr.responseText;

 	 	var campaignsData = JSON.parse(jsonData).campaigns;
 	 	showCampaignsInfo(campaignsData);
 	 } else {
 	 	console.log(xhr.statusText);

           tempContainer.innerHTML += '&lt;p class="error"&gt;Error getting ' +
                 target.name + ": "+ xhr.statusText +
                 ",code: "+ xhr.status + "&lt;/p&gt;";
 	 }
 	}
 }
 xhr.send();
}

var dataUrl = 'data/campaignsdata.json';
loadData(dataUrl);</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Some older Web browsers may bring up a File Download popup window when the content type of the server&#8217;s response is set to "application/json". Try to use the MIME type "text/html" instead, if you ran into this issue.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_json-in-cms"><a class="anchor" href="#_json-in-cms"></a>JSON in CMS</h4>
<div class="paragraph">
<p>Large-scale Web applications could be integrated with some Content Management Systems (CMS), which can be supplying content such as charity events, sales promotions, et al.  CMS servers can be introduced into the architecture of a Web application to separate the work on preparing the content from the application delivering it as shown in <a href="#FIG4-4">CMS in the picture</a> depicting a diagram of a with a Web application integrated with the CMS server.</p>
</div>
<div id="FIG4-4" class="imageblock">
<div class="content">
<img src="images/fig_04_04.png" alt="fig 04 04">
</div>
<div class="title">Figure 4. CMS in the picture</div>
</div>
<div class="paragraph">
<p>The content contributors and editors prepare the information on the charities and donation campaigns using a separate application, not the Save The Child page. The CMS server and the Web application server www.savesickchild.org may be located in the same or separate data centers. The server-side code of the Save The Child is making a call to a CMS server whenever the site visitor is requesting the information about charity events. If you get to pick a CMS for your future Web application make sure it offers data feed in JSON format.</p>
</div>
<div class="paragraph">
<p>Some time ago one of the authors of this book were helping Mercedes Benz USA in development of their consumer facing Web application where people could search, review and configure their next car. <a href="#FIG4-5">Current Mercedes deals from CMS</a> shows a snapshot taken from the mbusa.com. Three rectangular areas at the bottom were created by the Web designers to display today&#8217;s deals and promotions. The up-to-date content for these areas (in a JSON format) was retrieved from a CMS server when the user visited mbusa.com.</p>
</div>
<div id="FIG4-5" class="imageblock">
<div class="content">
<img src="images/fig_04_05.png" alt="fig 04 05">
</div>
<div class="title">Figure 5. Current Mercedes deals from CMS</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
There&#8217;s a side benefit of learning JSON - it&#8217;s used as data format in NoSQL databases like <a href="http://www.mongodb.com/">MongoDB</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_json-in-java"><a class="anchor" href="#_json-in-java"></a>JSON in Java</h3>
<div class="paragraph">
<p>If a Web browser receives JSON stream from the server the application needs to turn it into JavaScript objects. If a Web client needs to send the JavaScriot objects to the server they can be converted into JSON string. Similar tasks have to be performed on the server side. Our Save The Child application uses Java application server. There is a number of third-party Java libraries that can consume and generate JSON content.</p>
</div>
<div class="paragraph">
<p>There are several Java libraries to convert Java objects into their JSON representation and back, for example <a href="http://code.google.com/p/google-gson/">Googles Gson</a>, <a href="http://jackson.codehaus.org/">Jackson</a>, <a href="http://code.google.com/p/json-simple/">json-simple</a>.</p>
</div>
<div class="paragraph">
<p>Google&#8217;s Gson is probably the simplest one for use. It provides methods <code>toJson()</code> and <code>fromJson()</code> to convert Java objects to JSON and back. Gson allows pre-existing un-modifiable objects to be converted to and from JSON and Supports Java Generics. Gson works well with complex objects with deep inheritance hierarchies.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say JavaScript sends to Java the following JSON string:</p>
</div>
<div class="paragraph">
<p><code>{"fname": "Alex", "lname":"Smith","skillLevel": 11}</code></p>
</div>
<div class="paragraph">
<p>The Java code can turn it into an instance of the Customer object by calling the method <code>Gson.fromJson()</code>. Similarly, Java code can create a JSON string from an object instance. Both of these operations are illustrated below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">public Customer createCustomerFromJson(String jsonString){

    Gson myGson = new Gson();
    Customer cust = myGson.fromJson(jsonString, Customer.class);
    return cust;
}

public String createJsonFromCustomer(Customer cust){

	Gson gson = new Gson();

	return gson.toJson(cust, Customer.class);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, the declaration of the Java class <code>Customer</code> must exist in the in the classpath and don&#8217;t forget to include gson.jar to your Java project.</p>
</div>
<div class="paragraph">
<p>JSON data format is often used in non-JavaScript applications. For example, a Java server can exchange the JSON-formatted data with a .Net server.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The upcoming Java EE 7 specification includes JSR 353, which defines a standardized way for parsing and generating JSON. JSR 353 defines the Java API from JSON Processing (JSON-P) that shouldn&#8217;t be confused with another acronym <a href="http://json-p.org/">JSONP or JSON-P</a>, which is JSON with Padding (we&#8217;ll discuss it at the end of this chapter).
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compressing-json"><a class="anchor" href="#_compressing-json"></a>Compressing JSON</h3>
<div class="paragraph">
<p>JSON format is more compact than XML and is readable by the human beings. But when you are ready to deploy your application in production, you still want to compress the data so less bytes will travel over the wire to the user&#8217;s browser. The server-side libraries that generate JSON will make the data sent to the client compact by removing the tab and the new line characters.</p>
</div>
<div class="paragraph">
<p>If you want to turn the pretty-print JSON into a more compact one-line format just use such Web sites as <a href="http://javascriptcompressor.com/">JavaScript Compressor</a> or <a href="http://www.freeformatter.com/json-formatter.html/">JSON Formatter</a>. For example, after running the 12Kb file countries.json through this compressor, its size was decreased to 9Kb. JSONLint can also compress JSON if you provide this URL: <a href="http://jsonlint.com?reformat=compress">http://jsonlint.com?reformat=compress</a>.</p>
</div>
<div class="paragraph">
<p>Similarly to most of the content that is being sent to browsers by the Web servers, the JSON data should be compressed. <a href="http://en.wikipedia.org/wiki/Gzip">GZip</a> and <a href="http://en.wikipedia.org/wiki/DEFLATE">Deflate</a> are the two main compression methods used in today&#8217;s Web. Both use the same compression algorithm <em>deflate</em>, but while with Deflate the compressed data are being streamed to the client, the GZip first compresses the entire file, calculates the size and adds some additional headers to the compressed data. So GZip may need some extra time and memory, but you are more protected from getting incomplete JSON, JavaScript or other content. Both Gzip and Deflate are easily configurable by major Web servers, but it&#8217;s hard to say which one is better for your application - set up some tests with each of them and decide which one works faster or take less system resources, but don&#8217;t compromise on reliability of the compressed content.</p>
</div>
<div class="paragraph">
<p>We prefer using GZip, which stands for GNU zip compression. On the server side you&#8217;d need to configure the gzip filters on your Web server. You need to refer to your Web server&#8217;s documentation to find out how to configure gzipping, which is done by the MIME type. For example, you can request to gzip everything except images (you might want to do this if you&#8217;re not sure if all browsers can properly uncompress certain MIME types).</p>
</div>
<div class="paragraph">
<p>For example, applying the GZip filter to the 9Kb countries.json will reduce its size to 3Kb, which means serious bandwidth savings especially in the Web applications with lots of concurrent users. This is even more important for the mobile Web clients, which may be operating in the areas with slower connections. The Web clients can set the HTTP request attribute <code>Accept-Encoding: gzip</code> inviting the server to return gzipped content, and the Web server may compress the response if it does support it or unzipped content otherwise. If the server supports gzip, the HTTP response will have the attribute <code>Content-Encoding: gzip</code>, and the browser will know to unzip the response data before use.</p>
</div>
<div class="paragraph">
<p>Gzip is being used for compressing all types of content: HTML, CSS, JavaScript and more. If your server sends JSON content to the client setting the content type to <code>application/json</code> don&#8217;t forget to include this MIME type in your server configuration for Gzip.</p>
</div>
<div class="paragraph">
<p>Web browsers support the gzipping too, and your application can set <code>Content-Ecoding: gzip</code> in HTTP request while sending the data from the Web client to the server. But Web clients usually don&#8217;t send massive amounts of data to the server so the benefits of the compression on the client side may not be as big.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adding-charts-to-save-the-child"><a class="anchor" href="#_adding-charts-to-save-the-child"></a>Adding Charts to Save The Child</h3>
<div class="paragraph">
<p>Let&#8217;s consider yet another use case for JSON in Save The Child. We want to display charts with statistics about the donations.  By now, our application look not exactly as the original mockup from <a href="#FIG3-2">[FIG3-2]</a>, but it&#8217;s pretty close. There is an empty space in the left to the maps, and the charts showing donation statistics can fit right in. Now we need to decide how to draw the charts using nothing, but HTML5 elements. Note that we are not talking about displaying static images using the <code>&lt;img&gt;</code> element - the goal is to draw the images dynamically in the client&#8217;s code. You can accomplish this goal using HTML5 elements <code>&lt;canvas&gt;</code> or <code>&lt;svg&gt;</code>.</p>
</div>
<div class="paragraph">
<p>The <a href="http://www.w3.org/wiki/HTML/Elements/canvas"><code>&lt;canvas&gt;</code></a> element provides a bitmap canvas, where your  scripts which can draw graphs, game graphics, or other visual images on the fly without using any plugins like Flash Player or Silverlight. To put it simple, the <code>&lt;canvas&gt;</code> defines a rectangular area that consists of pixels, where you can draw. Keep in mind that the DOM object can&#8217;t peek inside the canvas and access specific pixels. So if you are planning to create an area with dynamically changed graphics you might want to consider using <code>&lt;svg&gt;</code>.</p>
</div>
<div class="paragraph">
<p>The <a href="http://www.w3.org/TR/SVG11/"><code>&lt;svg&gt;</code> element</a> supports Scalable Vector Graphics (SVG), which is the XML-based language for describing two-dimensional graphics. Your code has to provide commands to draw the lines, text, images et al.</p>
</div>
<div class="sect3">
<h4 id="_adding-chart-with-canvas-element"><a class="anchor" href="#_adding-chart-with-canvas-element"></a>Adding Chart With Canvas Element</h4>
<div class="paragraph">
<p>Let&#8217;s review some code fragments from project-04-canvas-pie-chart-json. The HTML section defines <code>&lt;canvas&gt;</code> of 260x240 pixels. If the user&#8217;s browser doesn&#8217;t support <code>&lt;canvas&gt;</code>, the user won&#8217;t see the chart, but will see the text "Your browser does not support HTML5 Canvas" instead. You need to give an ID to your canvas element so your JavaScript code can access it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="html language-html">&lt;div id="charts-container"&gt;
    &lt;canvas id="canvas" width="260" height="240"&gt;
    	Your browser does not support HTML5 Canvas
    &lt;/canvas&gt;
    &lt;h3&gt;Donation Stats&lt;/h3&gt;
    &lt;p&gt; Lorem ipsum dolor sit amet, consectetur&lt;/p&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the project-04-canvas-pie-chart-json, and you&#8217;ll see the chart with donation statistics by city as in <a href="#FIG4-6">Adding a chart</a>. We haven&#8217;t style our <code>&lt;canvas&gt;</code> element, but we could&#8217;ve added a background color, the border and other bells and whistles if required.</p>
</div>
<div id="FIG4-6" class="imageblock">
<div class="content">
<img src="images/fig_04_06.png" alt="fig 04 06">
</div>
<div class="title">Figure 6. Adding a chart</div>
</div>
<div class="paragraph">
<p>The data to be used for drawing a pie chart in our canvas are stored in the file data/chartdata.json, but in a real-world the server side code can generate it based on the up-to-the-second donation data and send it to the client. For example, you could do it as was explained in the section Json in Java above. This is the content of our file chartdata.json:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">{
  "ChartData": {
    "items": [
      {
        "donors": 48,
        "location":"Chicago, IL"
      },
      {
        "donors": 60,
        "location": "New York, NY"
      },
      {
        "donors": 90,
        "location":"Dallas, TX"
      },
      {
        "donors": 22,
        "location":"Miami, FL"
      },
      {
        "donors": 14,
        "location":"Fargo, ND"
      },
      {
        "donors": 44,
        "location":"Long Beach, NY"
      },
      {
        "donors": 24,
        "location":"Lynbrook, NY"
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Loading of the the charddata.json is done using AJAX techniques as explained earlier. Although in our example we&#8217;re loading the chart immediately when the Save The Child loads, the following code could be invoked only when the user requests to see the charts by clicking on some menu item on the page.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">function getData(dataUrl, canvas) {
  var xhr = new XMLHttpRequest();
  xhr.open('GET', dataUrl, true);

  xhr.onreadystatechange = function() {
  	if (xhr.readyState == 4) {
            if ((xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) ||
                                      xhr.status === 304) {
  			var jsonData = xhr.responseText;

  			var chartData = JSON.parse(jsonData).ChartData;       <i class="conum" data-value="1"></i><b>(1)</b>


  			drawPieChart(canvas, chartData, 50, 50, 49);       <i class="conum" data-value="2"></i><b>(2)</b>

  		} else {
  			console.log(xhr.statusText);
  			tempContainer.innerHTML += '&lt;p class="error"&gt;Error getting ' +
                               target.name + ": "+ xhr.statusText +
                               ",code: "+ xhr.status + "&lt;/p&gt;";
  		}
  	}
  }
  xhr.send();
}

loadData('data/chartdata.json', document.getElementById("canvas"));</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Parse JSON and create the <code>ChartData</code> Javascript object.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Pass the data to the <code>drawPieChart()</code> function that will draw the pie in the <code>canvas</code> element with the center coordinates x=50 and y=50 pixels. The top left corner of the canvas has coordinates (0,0). The radius of the pie will be 49 pixels. The code of the function that draws the pie on the canvas goes next.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">function drawPieChart (canvas, chartData, centerX, centerY, pieRadius) {
	var ctx;  // The context of canvas
	var previousStop = 0;  // The end position of the slice
	var totalDonors = 0;

	var totalCities = chartData.items.length;

    // Count total donors
	for (var i = 0; i &lt; totalCities; i++) {
			totalDonors += chartData.items[i].donors;     <i class="conum" data-value="1"></i><b>(1)</b>
	}

	ctx = canvas.getContext("2d");                        <i class="conum" data-value="2"></i><b>(2)</b>
	ctx.clearRect(0, 0, canvas.width, canvas.heigh);

    var colorScheme = ["#2F69BF", "#A2BF2F", "#BF5A2F",   <i class="conum" data-value="3"></i><b>(3)</b>
            "#BFA22F", "#772FBF", "#2F94BF", "#c3d4db"];

	for (var i = 0; i &lt; totalCities; i++) {               <i class="conum" data-value="4"></i><b>(4)</b>

		//draw the sector
		ctx.fillStyle = colorScheme[i];
		ctx.beginPath();
		ctx.moveTo(centerX, centerY);
		ctx.arc(centerX, centerY, pieRadius, previousStop, previousStop +
			(Math.PI * 2 * (chartData.items[i].donors/totalDonors)),false);
		ctx.lineTo(centerX, centerY);
		ctx.fill();

		// label's bullet
		var labelY = 20 * i + 10;
		var labelX = pieRadius*2 + 20;

		ctx.rect(labelX, labelY, 10, 10);
		ctx.fillStyle = colorScheme[i];
		ctx.fill();

		// label's text
		ctx.font = "italic 12px sans-serif";
		ctx.fillStyle = "#222";
		var txt = chartData.items[i].location + " | " +
		                              chartData.items[i].donors;
		ctx.fillText (txt, labelX + 18, labelY + 8);

		previousStop += Math.PI * 2 * (chartData.items[i].donors/totalDonors);
	}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Count the total number of donors.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get the 2D context of the <code>&lt;canvas&gt;</code> element. This is the most crucial element to know for drawing on a canvas.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The color scheme is just a set of colors to be used for painting each slice (sector) of the pie.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The for-loop paints one sector on each iteration. This code draws lines, arcs, rectangles, and adds text to the canvas. Describing the details of each method of the context object is out of scope of this book, but you can find the details of the context API in the <a href="http://www.w3.org/TR/2dcontext/">W3C documentation</a> available online.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_adding-chart-with-svg"><a class="anchor" href="#_adding-chart-with-svg"></a>Adding Chart With SVG</h4>
<div class="paragraph">
<p>What if we want to make this chart dynamic and reflect the changes in donations every 5 minutes? If you&#8217;re using <code>&lt;canvas&gt;</code>, you&#8217;ll need to redraw each and every pixel of our canvas with the pie.	With SVG, each element of the drawing would be the DOM element so we could have redraw only those elements that have changed. If with canvas your script draws using pixels, the SVG drawings are done with vectors.</p>
</div>
<div class="paragraph">
<p>To implement the same donation statistics pie with the <code>&lt;svg&gt;</code> element, you&#8217;d need to replace the <code>&lt;canvas&gt;</code> element with the following markup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="html language-html">&lt;div id="charts-container"&gt;
	&lt;svg id="svg-container" xmlns="http://www.w3.org/2000/svg"&gt;

	&lt;/svg&gt;
	&lt;h3&gt;Donation Stats&lt;/h3&gt;
	&lt;p&gt;
		Lorem ipsum dolor sit amet, consectetur
	&lt;/p&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Running the project-05-svg-pie-chart-json would show you pretty much the same pie as it uses the file chartdata.json with the same content, but the pie was produced differently. The code of the new version of the <code>drawPieChart()</code> is shown below. We won&#8217;t discuss all the details of the drawing with SVG, but will highlight the a couple of important lines of code that illustrate the difference between drawing on <code>&lt;canvas&gt;</code> vs. <code>&lt;svg&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">function drawPieChart(chartContaner, chartData, centerX, centerY,
                          pieRadius, chartLegendX, chartLegendY) {
	// the XML namespace for svg elements
	var namespace = "http://www.w3.org/2000/svg";
    var colorScheme = ["#2F69BF", "#A2BF2F", "#BF5A2F", "#BFA22F",
                      "#772FBF", "#2F94BF", "#c3d4db"];

	var totalCities = chartData.items.length;
	var totalDonors = 0;

     // Count total donors
	for (var i = 0; i &lt; totalCities; i++) {
		totalDonors += chartData.items[i].donors;
	}

	// Draw pie sectors
	startAngle = 0;
	for (var i = 0; i &lt; totalCities; i++) {
		// End of the sector = starting angle + sector size
		var endAngle = startAngle + chartData.items[i].donors / totalDonors * Math.PI * 2;
		var x1 = centerX + pieRadius * Math.sin(startAngle);
		var y1 = centerY - pieRadius * Math.cos(startAngle);
		var x2 = centerX + pieRadius * Math.sin(endAngle);
		var y2 = centerY - pieRadius * Math.cos(endAngle);

		// This is a flag for angles larger than than a half circle
		// It is required by the SVG arc drawing component
		var big = 0;
		if (endAngle - startAngle &gt; Math.PI) {
			big = 1;
		}

		//Create the &lt;svg:path&gt; element
		var path = document.createElementNS(namespace, "path");   <i class="conum" data-value="1"></i><b>(1)</b>

        // Start at circle center
		var pathDetails = "M " + centerX + "," + centerY +       //  <i class="conum" data-value="2"></i><b>(2)</b>
		// Draw line to (x1,y1)
		" L " + x1 + "," + y1 +
		// Draw an arc of radius
		" A " + pieRadius + "," + pieRadius +
		// Arc's details
		" 0 " + big + " 1 " +
		// Arc goes to to (x2,y2)
		x2 + "," + y2 +
		" Z";
		// Close the path at (centerX, centerY)

		// Attributes for the &lt;svg:path&gt; element
		path.setAttribute("d", pathDetails);
		// Sector fill color
		path.setAttribute("fill", colorScheme[i]);

		chartContaner.appendChild(path);                    <i class="conum" data-value="3"></i><b>(3)</b>

		// The next sector begins where this one ends
		startAngle = endAngle;

		// label's bullet
		var labelBullet = document.createElementNS(namespace, "rect");
		// Bullet's position
		labelBullet.setAttribute("x", chartLegendX);
		labelBullet.setAttribute("y", chartLegendY + 20 * i);

    // Bullet's size
		labelBullet.setAttribute("width", 10);
		labelBullet.setAttribute("height", 10);
		labelBullet.setAttribute("fill", colorScheme[i]);

		chartContaner.appendChild(labelBullet);             <i class="conum" data-value="3"></i><b>(3)</b>

		// Add the label text
		var labelText = document.createElementNS(namespace, "text");

    // label position = bullet's width(10px) + padding(8px)
		labelText.setAttribute("x", chartLegendX + 18);
		labelText.setAttribute("y", chartLegendY + 20 * i + 10);
		var txt = document.createTextNode(chartData.items[i].location +
		" | "+chartData.items[i].donors);

		labelText.appendChild(txt);
		chartContaner.appendChild(labelText);               //  <i class="conum" data-value="3"></i><b>(3)</b>
	}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create the <code>&lt;svg:path&gt;</code> HTML element, which is the most important SVG element for drawing basic shapes.. It includes a series of commands that produce the required drawing. For example, <em>M 10 10</em> means <em>movo to the coordinate 10,10</em> and <em>L 20 30</em> means <em>draw the line to the coordinate 20,30</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Fill the details of the <code>&lt;svg:path&gt;</code> element to draw the pie sector.
Run the project-05-svg-pie-chart-json to see the Save The Child page, then right-click on the pie chart and select Inspect Element (this is the name of the menu item in Firefox). <a href="#FIG4-7">The chart content in SVG</a> shows the resulting content of our <code>&lt;svg&gt;</code> element. As you can see, it&#8217;s not pixel based but a set of XML-like commands that drew the content of the chart. If you&#8217;ll run the previous version of our application (project-04-canvas-pie-chart-json) and right-click on the chart, you will be able to save it as an image, but won&#8217;t see the internals of the <code>&lt;canvas&gt;</code> element.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Adding the internal elements of the chart container to the DOM - path, bullets and text. These elements can be modified if needed without redrawing the entire content of the container.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
in our code example we have written the path commands manually to process the data dynamically. But Web designers often use tools (<a href="http://www.adobe.com/products/illustrator.html">Adobe Illustrator</a>, <a href="http://inkscape.org/">Incscape</a> et al.) to draw and then export images into an SVG format. In this case all paths will be encoded as <code>&lt;svg:path&gt;</code> automatically.
</td>
</tr>
</table>
</div>
<div id="FIG4-7" class="imageblock">
<div class="content">
<img src="images/fig_04_07.png" alt="fig 04 07">
</div>
<div class="title">Figure 7. The chart content in SVG</div>
</div>
<div class="paragraph">
<p>Since the SVG is XML-based, its very easy to generate the code shown in <a href="#FIG4-7">The chart content in SVG</a> on the server, and lots of Web applications send ready to display SVG graphics to the users' Web browsers. But in our example we are generating the SVG output in the JavaScript from JSON received from the server, which provides a cleaner separation between the client and the server-side code. The final decision on what to send to the Web browser (ready to render SVG or raw JSON) has to be made after considering various factors such as available bandwidth, the size of data, the number of users, the existing load on the server resources.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
SVG supports animations and transformation effects, while canvas doesn&#8217;t.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_what-is-jsonp"><a class="anchor" href="#_what-is-jsonp"></a>What is JSONP</h3>
<div class="paragraph">
<p>Imagine that a Web page was loaded from the domain abc.com, and it need JSON formatted data from another domain (xyz.com). As mentioned earlier, AJAX has cross-origin restrictions, which prevent this. JSONP is a technique used in to relax the cross-origin restrictions.  With JSONP, instead of sending plain JSON data, the server wraps them up into a JavaScript function and then sends it to the Web browser for execution as a callback. The Web page that was originated from abc.com may send the request <code>http://xyz.com?callback=myDataHandler</code> technically requesting the server xyz.com to invoke the JavaScript callback named <code>myDataHandler</code>. This URL is a regular HTTP GET request, which may have other parameters too so you can send some data to the server too.</p>
</div>
<div class="paragraph">
<p>The server will send to the browser the JavaScript function that may look as follow:</p>
</div>
<div class="paragraph">
<p><code>function myDataHandler({"fname": "Alex", "lname":"Smith","skillLevel": 11});</code></p>
</div>
<div class="paragraph">
<p>The Web browser will invoke the callback <code>myDataHandler()</code>, which must exist in the Web page. The Web browser will pass the received JSON object as an argument to this callback:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">function myDataHandler(data){
  // process the content of the argument data - the JSON object
  // received from xyz.com
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If all you need is just to retrieve the data from a different domain on page just add the following tag to your HTML page:</p>
</div>
<div class="paragraph">
<p><code>&lt;script src="http://xyz.com?callback=myDataHandler"&gt;</code></p>
</div>
<div class="paragraph">
<p>But what if you need to dynamically make such requests periodically (e.g. get all twits with a hashtag <code>#savisickchild</code> by sending an HTTP GET using Twitter API at <code>http://search.twitter.com/search.json?q=savesickchild&amp;rpp=5&amp;include_entities=true&amp;with_twitter_user_id=true&amp;result_type=mixed</code>)? You add a change handler to the option that is called and passes or grabs the value needed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can dynamically add a <code>&lt;script&gt;</code> tag to the DOM object from your JavaScript code. Whenever the browser sees the new <code>&lt;script&gt;</code> element it executes it. Such script injection can be done like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">var myScriptTag = document.createElement("script");
myScriptTag.src = "http://xyz.com?callback=myDataHandler";
document.getElementsByTagName("body").appendChild(myScriptTag);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your JavaScript can build the URL for the <code>myScriptTag.src</code> dynamically and pass parameters to the server based on some user&#8217;s actions, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">myScriptTag.src = "http://xyz.com?city=Boston&amp;callback=myDataHandler";</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, this technique presents a danger if there is a chance that the JavaScript code sent by xyz.com is intercepted and replaced by a malicious code. But it&#8217;s not more dangerous that receiving any JavaScript from non-trusted  server. Besides, your handler function could always make sure that the received data is a valid object with expected properties, and only after that handle the data.</p>
</div>
<div class="paragraph">
<p>If you decide to use JSONP don&#8217;t forget about error handling. Most likely you&#8217;ll be using one of the JavaScript frameworks and they usually offer a standard mechanism for JSONP error handling, dealing with poorly formatted JSON responses, and recovery in cases of network failure. One of such libraries is called <a href="https://github.com/jaubourg/jquery-jsonp">jQuery-JSONP</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_beer-and-jsonp"><a class="anchor" href="#_beer-and-jsonp"></a>Beer and JSONP</h4>
<div class="paragraph">
<p>In this section you&#8217;ll see a small code example illustrating the data retrieval from publicly publicly available <a href="http://openbeerdatabase.com/">Open Beer DataBase</a>, which exists to help software developers test their code that makes REST Web service calls and works with JSON and JSONP data. Our Save The Child page won&#8217;t display beer bottles, but we want to show that in addition to the retrieval of the donations and charts data from one domain we can get the data from a third-party domain openbeerdatabase.com.</p>
</div>
<div class="paragraph">
<p>First, enter the URL <code>http://api.openbeerdatabase.com/v1/breweries.json</code> in the address bar of your Web browser, and it&#8217;ll return the following JSON data (only 2 out of 7 breweries are shown for brevity):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">{
   "page": 1,
   "pages": 1,
   "total": 7,
   "breweries": [
       {
           "id": 1,
           "name": "(512) Brewing Company",
           "url": "http://512brewing.com",
           "created_at": "2010-12-07T02:53:38Z",
           "updated_at": "2010-12-07T02:53:38Z"
       },
       {
           "id": 2,
           "name": "21st Amendment Brewing",
           "url": "http://21st-amendment.com",
           "created_at": "2010-12-07T02:53:38Z",
           "updated_at": "2010-12-07T02:53:38Z"
       }
   ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s request the same data, but in a JSONP format by adding to the URL a parameter with a callback name <code>myDataHandler</code>. Entering in the browser <code>http://api.openbeerdatabase.com/v1/breweries.json?callback=processBeer</code> will return the following (it&#8217;s a short version):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">processBeer({"page":1,"pages":1,"total":7,"breweries":[{"id":1,"name":"(512) Brewing Company",
"url":"http://512brewing.com","created_at":"2010-12-07T02:53:38Z",
"updated_at":"2010-12-07T02:53:38Z"},{"id":2,"name":"21st Amendment Brewing",
"url":"http://21st-amendment.com","created_at":"2010-12-07T02:53:38Z",
"updated_at":"2010-12-07T02:53:38Z"}]})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since we haven&#8217;t declared the function <code>processBeer()</code> yet, it won&#8217;t be invoked. Let&#8217;s fix it now. The function will check first if the received data contains the information about the breweries. If it does, the name of the very first brewery will be printed on the JavaScript console. Otherwise the console output will read "Retrieved data has no breweries info".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">var processBeer=function (data){

   // Uncomment the next line to emulate malicious data
   // data="function evilFunction(){alert(' Bad function');}";

     if (data.breweries == undefined){
      console.log("Retrieved data has no breweries info.");
     } else{
      console.log("In the processBeer callback. The first brewery is "
                  + data.breweries[0].name);
     }
  }

var myScriptTag = document.createElement("script");
  myScriptTag.src =
    "http://api.openbeerdatabase.com/v1/breweries.json?callback=processBeer";

var bd = document.getElementsByTagName('body')[0];
bd.appendChild(myScriptTag);</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#FIG4-8">The beer has arrived</a> is a screen snapshot taken in the Firebug when it reached the breakpoint placed inside the processBeer callback on the <code>console.log(in the processBeer callback")</code>. You can see the content of the <code>data</code> argument - the beer has arrived.</p>
</div>
<div id="FIG4-8" class="imageblock">
<div class="content">
<img src="images/fig_04_08.png" alt="fig 04 08">
</div>
<div class="title">Figure 8. The beer has arrived</div>
</div>
<div class="paragraph">
<p>As a training exercise, try to replace the data retrieval from the beer Web service with adding the data feed from Twitter based on certain hash tags. See if you can find the place in the Save The Child Web page to display (and periodically update) this Twitter stream.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<a href="http://www.json-generator.com">json-generator.com</a> is a handy Web site that can generate a file with a JSON or JSONP content based on your template. You can use this service to test AJAX queries - the generated JSON can be saved on this server to help in testing of your Web application.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h3>
<div class="paragraph">
<p>In this chapter you&#8217;ve learned about using AJAX as a means of communications of your Web browser with the servers. AJAX also deserves a credit for making the JavaScript language popular again by showing a practical way of creating single-page Web applications. Over the years JSON became the standard way of exchanging the data on the Web. The current version of the Save The Child application cleanly separates the code from the data, and you know how to update the content of the Web page without the need to re-retrieve the entire page from the server. In the next chapter you&#8217;ll get familiar with the more productive way of developing Web applications with the library called jQuery.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2014-01-03 17:51:50 EST
</div>
</div>
</body>
</html>