<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Asciidoctor 0.1.4">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modularizing Large-Scale JavaScript Projects</title>
<style>
@import url(http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.0/css/font-awesome.css);
@import url(http://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic);
/* normalize.css v2.1.1 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }
/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }
/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }
/** Address styling not present in IE 8/9. */
[hidden] { display: none; }
/* ========================================================================== Base ========================================================================== */
/** 1. Prevent system color scheme's background color being used in Firefox, IE, and Opera. 2. Prevent system color scheme's text color being used in Firefox, IE, and Opera. 3. Set default font family to sans-serif. 4. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { background: #fff; /* 1 */ color: #000; /* 2 */ font-family: sans-serif; /* 3 */ -ms-text-size-adjust: 100%; /* 4 */ -webkit-text-size-adjust: 100%; /* 4 */ }
/** Remove default margin. */
body { margin: 0; }
/* ========================================================================== Links ========================================================================== */
/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }
/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }
/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }
/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }
/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }
/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }
/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }
/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }
/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }
/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }
/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }
/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }
/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }
/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }
/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }
/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }
/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }
/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }
/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }
/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }
/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }
/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }
/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }
/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }
/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }
/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }
/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }
/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }
/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }
*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
html, body { font-size: 100%; }
body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }
a:hover { cursor: pointer; }
a:focus { outline: none; }
img, object, embed { max-width: 100%; height: auto; }
object, embed { height: 100%; }
img { -ms-interpolation-mode: bicubic; }
#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }
.left { float: left !important; }
.right { float: right !important; }
.text-left { text-align: left !important; }
.text-right { text-align: right !important; }
.text-center { text-align: center !important; }
.text-justify { text-align: justify !important; }
.hide { display: none; }
.antialiased, body { -webkit-font-smoothing: antialiased; }
img { display: inline-block; vertical-align: middle; }
textarea { height: auto; min-height: 50px; }
select { width: 100%; }
/* Grid HTML Classes */
.row { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; }
.row:before, .row:after { content: " "; display: table; }
.row:after { clear: both; }
.row.collapse .column, .row.collapse .columns { position: relative; padding-left: 0; padding-right: 0; float: left; }
.row .row { width: auto; margin-left: -0.9375em; margin-right: -0.9375em; margin-top: 0; margin-bottom: 0; max-width: none; *zoom: 1; }
.row .row:before, .row .row:after { content: " "; display: table; }
.row .row:after { clear: both; }
.row .row.collapse { width: auto; margin: 0; max-width: none; *zoom: 1; }
.row .row.collapse:before, .row .row.collapse:after { content: " "; display: table; }
.row .row.collapse:after { clear: both; }
.column, .columns { position: relative; padding-left: 0.9375em; padding-right: 0.9375em; width: 100%; float: left; }
@media only screen { .column, .columns { position: relative; padding-left: 0.9375em; padding-right: 0.9375em; float: left; }
  .small-1 { position: relative; width: 8.33333%; }
  .small-2 { position: relative; width: 16.66667%; }
  .small-3 { position: relative; width: 25%; }
  .small-4 { position: relative; width: 33.33333%; }
  .small-5 { position: relative; width: 41.66667%; }
  .small-6 { position: relative; width: 50%; }
  .small-7 { position: relative; width: 58.33333%; }
  .small-8 { position: relative; width: 66.66667%; }
  .small-9 { position: relative; width: 75%; }
  .small-10 { position: relative; width: 83.33333%; }
  .small-11 { position: relative; width: 91.66667%; }
  .small-12 { position: relative; width: 100%; }
  .small-offset-0 { position: relative; margin-left: 0%; }
  .small-offset-1 { position: relative; margin-left: 8.33333%; }
  .small-offset-2 { position: relative; margin-left: 16.66667%; }
  .small-offset-3 { position: relative; margin-left: 25%; }
  .small-offset-4 { position: relative; margin-left: 33.33333%; }
  .small-offset-5 { position: relative; margin-left: 41.66667%; }
  .small-offset-6 { position: relative; margin-left: 50%; }
  .small-offset-7 { position: relative; margin-left: 58.33333%; }
  .small-offset-8 { position: relative; margin-left: 66.66667%; }
  .small-offset-9 { position: relative; margin-left: 75%; }
  .small-offset-10 { position: relative; margin-left: 83.33333%; }
  [class*="column"] + [class*="column"]:last-child { float: right; }
  [class*="column"] + [class*="column"].end { float: left; }
  .column.small-centered, .columns.small-centered { position: relative; margin-left: auto; margin-right: auto; float: none !important; } }
/* Styles for screens that are atleast 768px; */
@media only screen and (min-width: 768px) { .large-1 { position: relative; width: 8.33333%; }
  .large-2 { position: relative; width: 16.66667%; }
  .large-3 { position: relative; width: 25%; }
  .large-4 { position: relative; width: 33.33333%; }
  .large-5 { position: relative; width: 41.66667%; }
  .large-6 { position: relative; width: 50%; }
  .large-7 { position: relative; width: 58.33333%; }
  .large-8 { position: relative; width: 66.66667%; }
  .large-9 { position: relative; width: 75%; }
  .large-10 { position: relative; width: 83.33333%; }
  .large-11 { position: relative; width: 91.66667%; }
  .large-12 { position: relative; width: 100%; }
  .row .large-offset-0 { position: relative; margin-left: 0%; }
  .row .large-offset-1 { position: relative; margin-left: 8.33333%; }
  .row .large-offset-2 { position: relative; margin-left: 16.66667%; }
  .row .large-offset-3 { position: relative; margin-left: 25%; }
  .row .large-offset-4 { position: relative; margin-left: 33.33333%; }
  .row .large-offset-5 { position: relative; margin-left: 41.66667%; }
  .row .large-offset-6 { position: relative; margin-left: 50%; }
  .row .large-offset-7 { position: relative; margin-left: 58.33333%; }
  .row .large-offset-8 { position: relative; margin-left: 66.66667%; }
  .row .large-offset-9 { position: relative; margin-left: 75%; }
  .row .large-offset-10 { position: relative; margin-left: 83.33333%; }
  .row .large-offset-11 { position: relative; margin-left: 91.66667%; }
  .push-1 { position: relative; left: 8.33333%; right: auto; }
  .pull-1 { position: relative; right: 8.33333%; left: auto; }
  .push-2 { position: relative; left: 16.66667%; right: auto; }
  .pull-2 { position: relative; right: 16.66667%; left: auto; }
  .push-3 { position: relative; left: 25%; right: auto; }
  .pull-3 { position: relative; right: 25%; left: auto; }
  .push-4 { position: relative; left: 33.33333%; right: auto; }
  .pull-4 { position: relative; right: 33.33333%; left: auto; }
  .push-5 { position: relative; left: 41.66667%; right: auto; }
  .pull-5 { position: relative; right: 41.66667%; left: auto; }
  .push-6 { position: relative; left: 50%; right: auto; }
  .pull-6 { position: relative; right: 50%; left: auto; }
  .push-7 { position: relative; left: 58.33333%; right: auto; }
  .pull-7 { position: relative; right: 58.33333%; left: auto; }
  .push-8 { position: relative; left: 66.66667%; right: auto; }
  .pull-8 { position: relative; right: 66.66667%; left: auto; }
  .push-9 { position: relative; left: 75%; right: auto; }
  .pull-9 { position: relative; right: 75%; left: auto; }
  .push-10 { position: relative; left: 83.33333%; right: auto; }
  .pull-10 { position: relative; right: 83.33333%; left: auto; }
  .push-11 { position: relative; left: 91.66667%; right: auto; }
  .pull-11 { position: relative; right: 91.66667%; left: auto; }
  .column.large-centered, .columns.large-centered { position: relative; margin-left: auto; margin-right: auto; float: none !important; }
  .column.large-uncentered, .columns.large-uncentered { margin-left: 0; margin-right: 0; float: left !important; }
  .column.large-uncentered.opposite, .columns.large-uncentered.opposite { float: right !important; } }
/* Image Thumbnails */
.th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.2); box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.2); -webkit-transition: all 200ms ease-out; -moz-transition: all 200ms ease-out; transition: all 200ms ease-out; }
.th:hover, .th:focus { -webkit-box-shadow: 0 0 6px 1px rgba(43, 166, 203, 0.5); box-shadow: 0 0 6px 1px rgba(43, 166, 203, 0.5); }
.th.radius { -webkit-border-radius: 3px; border-radius: 3px; }
a.th { display: inline-block; }
button, .button { border-style: solid; border-width: 1px; cursor: pointer; font-family: inherit; font-weight: bold; line-height: 1; margin: 0 0 1.25em; position: relative; text-decoration: none; text-align: center; display: inline-block; padding-top: 0.75em; padding-right: 1.5em; padding-bottom: 0.8125em; padding-left: 1.5em; font-size: 1em; background-color: #2ba6cb; border-color: #2284a1; color: white; }
button:hover, button:focus, .button:hover, .button:focus { background-color: #2284a1; }
button:hover, button:focus, .button:hover, .button:focus { color: white; }
button.secondary, .button.secondary { background-color: #e9e9e9; border-color: #d0d0d0; color: #333333; }
button.secondary:hover, button.secondary:focus, .button.secondary:hover, .button.secondary:focus { background-color: #d0d0d0; }
button.secondary:hover, button.secondary:focus, .button.secondary:hover, .button.secondary:focus { color: #333333; }
button.success, .button.success { background-color: #5da423; border-color: #457a1a; color: white; }
button.success:hover, button.success:focus, .button.success:hover, .button.success:focus { background-color: #457a1a; }
button.success:hover, button.success:focus, .button.success:hover, .button.success:focus { color: white; }
button.alert, .button.alert { background-color: #c60f13; border-color: #970b0e; color: white; }
button.alert:hover, button.alert:focus, .button.alert:hover, .button.alert:focus { background-color: #970b0e; }
button.alert:hover, button.alert:focus, .button.alert:hover, .button.alert:focus { color: white; }
button.large, .button.large { padding-top: 1em; padding-right: 2em; padding-bottom: 1.0625em; padding-left: 2em; font-size: 1.25em; }
button.small, .button.small { padding-top: 0.5625em; padding-right: 1.125em; padding-bottom: 0.625em; padding-left: 1.125em; font-size: 0.8125em; }
button.tiny, .button.tiny { padding-top: 0.4375em; padding-right: 0.875em; padding-bottom: 0.5em; padding-left: 0.875em; font-size: 0.6875em; }
button.expand, .button.expand { padding-right: 0px; padding-left: 0px; width: 100%; }
button.left-align, .button.left-align { text-align: left; text-indent: 0.75em; }
button.right-align, .button.right-align { text-align: right; padding-right: 0.75em; }
button.disabled, button[disabled], .button.disabled, .button[disabled] { background-color: #2ba6cb; border-color: #2284a1; color: white; cursor: auto; opacity: 0.6; -webkit-box-shadow: none; box-shadow: none; }
button.disabled:hover, button.disabled:focus, button[disabled]:hover, button[disabled]:focus, .button.disabled:hover, .button.disabled:focus, .button[disabled]:hover, .button[disabled]:focus { background-color: #2284a1; }
button.disabled:hover, button.disabled:focus, button[disabled]:hover, button[disabled]:focus, .button.disabled:hover, .button.disabled:focus, .button[disabled]:hover, .button[disabled]:focus { color: white; }
button.disabled:hover, button.disabled:focus, button[disabled]:hover, button[disabled]:focus, .button.disabled:hover, .button.disabled:focus, .button[disabled]:hover, .button[disabled]:focus { background-color: #2ba6cb; }
button.disabled.secondary, button[disabled].secondary, .button.disabled.secondary, .button[disabled].secondary { background-color: #e9e9e9; border-color: #d0d0d0; color: #333333; cursor: auto; opacity: 0.6; -webkit-box-shadow: none; box-shadow: none; }
button.disabled.secondary:hover, button.disabled.secondary:focus, button[disabled].secondary:hover, button[disabled].secondary:focus, .button.disabled.secondary:hover, .button.disabled.secondary:focus, .button[disabled].secondary:hover, .button[disabled].secondary:focus { background-color: #d0d0d0; }
button.disabled.secondary:hover, button.disabled.secondary:focus, button[disabled].secondary:hover, button[disabled].secondary:focus, .button.disabled.secondary:hover, .button.disabled.secondary:focus, .button[disabled].secondary:hover, .button[disabled].secondary:focus { color: #333333; }
button.disabled.secondary:hover, button.disabled.secondary:focus, button[disabled].secondary:hover, button[disabled].secondary:focus, .button.disabled.secondary:hover, .button.disabled.secondary:focus, .button[disabled].secondary:hover, .button[disabled].secondary:focus { background-color: #e9e9e9; }
button.disabled.success, button[disabled].success, .button.disabled.success, .button[disabled].success { background-color: #5da423; border-color: #457a1a; color: white; cursor: auto; opacity: 0.6; -webkit-box-shadow: none; box-shadow: none; }
button.disabled.success:hover, button.disabled.success:focus, button[disabled].success:hover, button[disabled].success:focus, .button.disabled.success:hover, .button.disabled.success:focus, .button[disabled].success:hover, .button[disabled].success:focus { background-color: #457a1a; }
button.disabled.success:hover, button.disabled.success:focus, button[disabled].success:hover, button[disabled].success:focus, .button.disabled.success:hover, .button.disabled.success:focus, .button[disabled].success:hover, .button[disabled].success:focus { color: white; }
button.disabled.success:hover, button.disabled.success:focus, button[disabled].success:hover, button[disabled].success:focus, .button.disabled.success:hover, .button.disabled.success:focus, .button[disabled].success:hover, .button[disabled].success:focus { background-color: #5da423; }
button.disabled.alert, button[disabled].alert, .button.disabled.alert, .button[disabled].alert { background-color: #c60f13; border-color: #970b0e; color: white; cursor: auto; opacity: 0.6; -webkit-box-shadow: none; box-shadow: none; }
button.disabled.alert:hover, button.disabled.alert:focus, button[disabled].alert:hover, button[disabled].alert:focus, .button.disabled.alert:hover, .button.disabled.alert:focus, .button[disabled].alert:hover, .button[disabled].alert:focus { background-color: #970b0e; }
button.disabled.alert:hover, button.disabled.alert:focus, button[disabled].alert:hover, button[disabled].alert:focus, .button.disabled.alert:hover, .button.disabled.alert:focus, .button[disabled].alert:hover, .button[disabled].alert:focus { color: white; }
button.disabled.alert:hover, button.disabled.alert:focus, button[disabled].alert:hover, button[disabled].alert:focus, .button.disabled.alert:hover, .button.disabled.alert:focus, .button[disabled].alert:hover, .button[disabled].alert:focus { background-color: #c60f13; }
button, .button { padding-top: 0.8125em; padding-bottom: 0.75em; -webkit-appearance: none; }
button.tiny, .button.tiny { padding-top: 0.5em; padding-bottom: 0.4375em; -webkit-appearance: none; }
button.small, .button.small { padding-top: 0.625em; padding-bottom: 0.5625em; -webkit-appearance: none; }
button.large, .button.large { padding-top: 1.03125em; padding-bottom: 1.03125em; -webkit-appearance: none; }
@media only screen { button, .button { -webkit-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.5) inset; box-shadow: 0 1px 0 rgba(255, 255, 255, 0.5) inset; -webkit-transition: background-color 300ms ease-out; -moz-transition: background-color 300ms ease-out; transition: background-color 300ms ease-out; }
  button:active, .button:active { -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2) inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2) inset; }
  button.radius, .button.radius { -webkit-border-radius: 3px; border-radius: 3px; }
  button.round, .button.round { -webkit-border-radius: 1000px; border-radius: 1000px; } }
@media only screen and (min-width: 768px) { button, .button { display: inline-block; } }
p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }
.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #003b6b; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }
/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }
/* Default Link Styles */
a { color: #00579e; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #333333; }
a img { border: none; }
/* Default paragraph styles */
p { font-family: "Droid Serif", Georgia, "Times New Roman", Times, serif; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }
/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Droid Serif", Georgia, "Times New Roman", Times, serif; font-weight: normal; font-style: normal; color: #7b2d00; text-rendering: optimizeLegibility; margin-top: 0.5em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #ff6b15; line-height: 0; }
h1 { font-size: 2.125em; }
h2 { font-size: 1.6875em; }
h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }
h4 { font-size: 1.125em; }
h5 { font-size: 1.125em; }
h6 { font-size: 1em; }
hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }
/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }
strong, b { font-weight: bold; line-height: inherit; }
small { font-size: 60%; line-height: inherit; }
code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; color: #003426; }
/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; list-style-position: outside; font-family: "Droid Serif", Georgia, "Times New Roman", Times, serif; }
ul, ol { margin-left: 1.5em; }
/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }
/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }
/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }
/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: black; border-bottom: 1px dotted #dddddd; cursor: help; }
abbr { text-transform: none; }
/* Blockquotes */
blockquote { margin: 0 0 0.75em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #e15200; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #e15200; }
blockquote, blockquote p { line-height: 1.6; color: #333333; }
/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }
.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }
@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Print styles.  Inlined to avoid required HTTP connection: www.phpied.com/delay-loading-your-print-css/ Credit to Paul Irish and HTML5 Boilerplate (html5boilerplate.com)
*/
.print-only { display: none !important; }
@media print { * { background: transparent !important; color: #000 !important; /* Black prints faster: h5bp.com/s */ box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; /* h5bp.com/t */ }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #d8d8ce; }
table thead, table tfoot { background: -webkit-linear-gradient(top, #add386, #90b66a); font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: white; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #6d6e71; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #edf2f2; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }
a:hover, a:focus { text-decoration: underline; }
.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }
*:not(pre) > code { font-size: inherit; padding: 3px 2px 1px 2px; white-space: nowrap; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; text-shadow: none; }
pre, pre > code { line-height: 1.6; color: black; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }
kbd.keyseq { color: #333333; }
kbd:not(.keyseq) { display: inline-block; color: black; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }
kbd kbd:first-child { margin-left: 0; }
kbd kbd:last-child { margin-right: 0; }
.menuseq, .menu { color: black; }
#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 1.5em; padding-right: 1.5em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }
#header { margin-bottom: 2.5em; }
#header > h1 { color: #7b2d00; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #333333; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }
#toc { border-bottom: 1px solid #dddddd; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }
#toctitle { color: #003b6b; }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; }
  #toc.toc2 { position: fixed; width: 20em; left: 0; top: 0; border-right: 1px solid #dddddd; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; }
  #toc.toc2 > ul { font-size: .95em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; border-width: 0; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }
#content #toctitle { font-weight: bold; font-family: "Droid Serif", Georgia, "Times New Roman", Times, serif; font-size: 1em; padding-left: 0.125em; }
#footer { max-width: 100%; background-color: none; padding: 1.25em; }
#footer-text { color: black; line-height: 1.44; }
.sect1 { padding-bottom: 1.25em; }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }
#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #7b2d00; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #622400; }
.imageblock, .literalblock, .listingblock, .verseblock, .videoblock { margin-bottom: 1.25em; }
.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }
.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }
table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }
.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #333333; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }
.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #aaaaaa; box-shadow: 0 1px 8px #aaaaaa; }
.sidebarblock { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #003b6b; margin-top: 0; line-height: 1.6; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }
.literalblock > .content pre, .listingblock > .content pre { background: #eeeeee; border-width: 1px; border-style: dashed; border-color: #666666; -webkit-border-radius: 0; border-radius: 0; padding: 1.25em 1.5625em 1.125em 1.5625em; word-wrap: break-word; }
.literalblock > .content pre.nowrap, .listingblock > .content pre.nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock > .content pre > code, .listingblock > .content pre > code { display: block; }
@media only screen { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.72em; } }
@media only screen and (min-width: 768px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.81em; } }
@media only screen and (min-width: 1280px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.9em; } }
.listingblock > .content { position: relative; }
.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }
.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }
.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }
.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }
table.pyhltable { border: 0; margin-bottom: 0; }
table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }
table.pyhltable td.code { padding-left: .75em; padding-right: 0; }
.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }
.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }
table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }
.quoteblock { margin: 0 0 0.75em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 0.75em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: 0.8125em; color: #e15200; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }
table thead th, table tfoot th { font-weight: bold; }
table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 0; border-radius: 0; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }
table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }
table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }
table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child { margin-bottom: 0; }
th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }
th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }
th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }
th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }
th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }
th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }
p.tableblock.header { color: white; font-weight: bold; }
td > div.verse { white-space: pre; }
ol { margin-left: 1.75em; }
ul li ol { margin-left: 1.5em; }
dl dd { margin-left: 1.125em; }
dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }
ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.375em; }
ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }
ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }
ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }
ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }
ul.inline { margin: 0 auto 0.375em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }
.unstyled dl dt { font-weight: normal; font-style: normal; }
ol.arabic { list-style-type: decimal; }
ol.decimal { list-style-type: decimal-leading-zero; }
ol.loweralpha { list-style-type: lower-alpha; }
ol.upperalpha { list-style-type: upper-alpha; }
ol.lowerroman { list-style-type: lower-roman; }
ol.upperroman { list-style-type: upper-roman; }
ol.lowergreek { list-style-type: lower-greek; }
.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }
td.hdlist1 { padding-right: .8em; font-weight: bold; }
td.hdlist1, td.hdlist2 { vertical-align: top; }
.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }
.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }
.qanda > ol > li > p > em:only-child { color: #004985; }
.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.2); box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.2); }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }
.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }
a.image { text-decoration: none; }
span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }
.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }
div.unbreakable { page-break-inside: avoid; }
.big { font-size: larger; }
.small { font-size: smaller; }
.underline { text-decoration: underline; }
.overline { text-decoration: overline; }
.line-through { text-decoration: line-through; }
.aqua { color: #00bfbf; }
.aqua-background { background-color: #00fafa; }
.black { color: black; }
.black-background { background-color: black; }
.blue { color: #0000bf; }
.blue-background { background-color: #0000fa; }
.fuchsia { color: #bf00bf; }
.fuchsia-background { background-color: #fa00fa; }
.gray { color: #606060; }
.gray-background { background-color: #7d7d7d; }
.green { color: #006000; }
.green-background { background-color: #007d00; }
.lime { color: #00bf00; }
.lime-background { background-color: #00fa00; }
.maroon { color: #600000; }
.maroon-background { background-color: #7d0000; }
.navy { color: #000060; }
.navy-background { background-color: #00007d; }
.olive { color: #606000; }
.olive-background { background-color: #7d7d00; }
.purple { color: #600060; }
.purple-background { background-color: #7d007d; }
.red { color: #bf0000; }
.red-background { background-color: #fa0000; }
.silver { color: #909090; }
.silver-background { background-color: #bcbcbc; }
.teal { color: #006060; }
.teal-background { background-color: #007d7d; }
.white { color: #bfbfbf; }
.white-background { background-color: #fafafa; }
.yellow { color: #bfbf00; }
.yellow-background { background-color: #fafa00; }
span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }
.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #00579e; color: #004176; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }
.conum { display: inline-block; color: white !important; background-color: black; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
body { font-family: "Droid Serif", Georgia, "Times New Roman", Times, serif; font-size: 16px; color: #111; }
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { border-bottom: 1px solid #dddddd; }
#toctitle { color: #00406F; font-weight: normal; margin-top: 1.5em; }
.sidebarblock { border-color: #aaa; }
code { -webkit-border-radius: 4px; border-radius: 4px; }
p.tableblock.header { color: #6d6e71; }
</style>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/styles/default.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_modularizing_large_scale_javascript_projects">Modularizing Large-Scale JavaScript Projects</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_modularization_basics">Modularization basics</a></li>
<li><a href="#_roads_to_modularization">Roads To Modularization</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_the_module_pattern">The Module Pattern</a></li>
<li><a href="#_commonjs">CommonJS</a></li>
<li><a href="#amd_section">Asynchronous Module Definition</a></li>
<li><a href="#umd">Universal Module Definition</a></li>
<li><a href="#_ecmascript_6_modules">ECMAScript 6 Modules</a></li>
</ul>
</li>
<li><a href="#REQUIREJS">Dicing the Save The Child Application Into Modules</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#inside_config">Inside RequireJS configuration: config.js</a></li>
<li><a href="#_writing_amd_modules">Writing AMD Modules</a></li>
<li><a href="#_loading_modules_on_demand">Loading Modules On-Demand</a></li>
<li><a href="#requirejs_plugins">RequireJS plugins</a></li>
<li><a href="#using_reuiqrejs_optimizer">Using RequireJS Optimizer</a></li>
</ul>
</li>
<li><a href="#mediator_section">Loosely-Coupled Inter-Module Communications With Mediator</a></li>
<li><a href="#_summary">Summary</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_modularizing_large_scale_javascript_projects">Modularizing Large-Scale JavaScript Projects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Reducing the application startup latency and implementing lazy loading of certain parts of the application are the main reasons for modularization.</p>
</div>
<div class="paragraph">
<p>A good illustration of why you may want to consider modularization is a well designed Web application of the <a href="http://www.mbusa.com/">Mercedes Benz USA</a>. This Web application serves people who live in America and either own or consider purchasing cars from this European car manufacturer.</p>
</div>
<div class="paragraph">
<p>One of their purchasing options is called "European Delivery". An American resident who chooses this particular package can combine a vacation with her car purchase. She flies to the Mercedes Benz factory in Europe, picks up her car, and has a two week vacation, driving her new vehicle around in Europe. After the vacation is over, the car is shipped to her hometown in the US. Needless to say, this program adds several thousand dollars to the price of the car.</p>
</div>
<div class="paragraph">
<p>From an application design point of view, we don&#8217;t need to include the code that supports the European Delivery to each and every user&#8217;s who decided to visit mbusa.com. <em>If</em> the user visits the menu Owners and clicks on the European Delivery link, then <em>and only then</em> the required code and resources be pushed to the user&#8217;s computer or mobile device.</p>
</div>
<div class="paragraph">
<p>The snapshot in <a href="#FIG7-1">MB USA: Europian Delivery</a> was taken after clicking on this link with Chrome Developer tools panel open.</p>
</div>
<div id="FIG7-1" class="imageblock">
<div class="content">
<img src="./images/fig_07_01.png" alt="image">
</div>
<div class="title">Figure 1. MB USA: Europian Delivery</div>
</div>
<div class="paragraph">
<p>As you see, <em>1.9Mb</em> worth of code and other resources have been downloaded as a result of this click. Should the application architects of the MB USA decided to bring this code to the user&#8217;s device on the initial load of <a href="http://mbusa.com">http://mbusa.com</a>, the wait time would increase by another second or more. This  is unnecessary because only a tiny number of American drivers would be interested in exploring the European Delivery option. This example illustrates the use case where modularization and lazy loading is needed.</p>
</div>
<div class="paragraph">
<p>Our Save The Child application is not as big as the one by Mercedes Benz. But we&#8217;ll use it to give you an example of how to build modularized Web applications that won&#8217;t bring the large and monolithic code to the client&#8217;s machine, but will load the code on as needed basis. We&#8217;ll also give an example of how to organize the data exchange between different programming modules in a loosely coupled fashion.</p>
</div>
<div class="paragraph">
<p>Users consider a Web application fast for one of two reasons: either it&#8217;s actually fast or it gives an impression of being fast. Ideally, you should do your best to create a Web application that&#8217;s very responsive.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
No matter how slow your Web application is, it should never feel like it&#8217;s being frozen.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This chapter is about modularization techniques that will allow quick rendering of the first page of your Web application by the user&#8217;s browser while loading the rest of the application in the background or on demand. We will continue refactoring the Save The Child application to illustrate using modules.</p>
</div>
<div class="paragraph">
<p>In this chapter we&#8217;re going to discuss the following frameworks for modularization of JavaScript projects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://browserify.org/">Browserify</a></p>
</li>
<li>
<p><a href="http://requirejs.org/">RequireJS</a> and RequireJS Optimizer - r.js</p>
</li>
<li>
<p><a href="https://github.com/square/es6-module-transpiler">ECMASctipt 6 (ES6) Module Transpiler</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_modularization_basics">Modularization basics</h3>
<div class="paragraph">
<p>Modules are code fragments that implement certain functionality and are written using a specific techniques. There is no out-of-the box modularization scheme in JavaScript language. The upcoming ECMAScript 6 specification tends to resolve this by introducing the <em>module concept</em> in the JavaScript language itself. This is the future.</p>
</div>
<div class="paragraph">
<p>You may ask, "Aren&#8217;t .js files modules already?" Of course, you can include and load each JavaScript file using the <code>&lt;script&gt;</code> tag. But this approach is error prone and slow. Developers have to manually manage dependencies and file loading order. Moreover, each <code>&lt;script&gt;</code> tag results in the  additional HTTP call to the server.</p>
</div>
<div class="paragraph">
<p>As the application gets larger the number of script files grows accordingly, which is illustrated in the following
<a href="#LISTING_SCRIPT_TAG">code sample</a>.</p>
</div>
<div id="LISTING_SCRIPT_TAG" class="listingblock">
<div class="title">Multiple <code>&lt;script&gt;</code> tags complicate controlling  application dependencies</div>
<div class="content">
<pre class="highlight"><code class="html language-html">&lt;!DOCTYPE html&gt;

&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="utf-8"&gt;

    &lt;title&gt;Save The Child | Home Page&lt;/title&gt;
    &lt;link rel="stylesheet" href="assets/css/styles.css"&gt;

    &lt;script src="components/jquery.js&gt;&lt;/script&gt;     <i class="conum" data-value="1"></i><b>(1)</b>

    &lt;script type="text/javascript" src="app/modules/utils/load-html-content.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="app/modules/utils/show-hide-div.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="app/modules/svg-pie-chart.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="app/modules/donation.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="app/modules/login.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="app/modules/utils/new-content-loader.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="app/modules/generic-module.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="app/modules/module1.js"&gt;&lt;/script&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    &lt;script type="text/javascript" src="app/modules/module2.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="app/config.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="app/main.js"&gt;&lt;/script&gt; <i class="conum" data-value="3"></i><b>(3)</b>

&lt;/head&gt;
&lt;body&gt;
&lt;!-- page body --&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Loading the jQuery first because all other modules depend on it.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Other application components may also have internal dependencies on other scripts. Those scripts need to be loaded before the respective components. Having the proper order of these script tags is very important.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The script for the main Web page should be loaded after all dependencies have finished loading.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see, we need a better way to modularize applications than simply adding <code>&lt;script&gt;</code> tags. As our first step, we can use the Module design pattern and leverage the so-called "Immediately Invoked Function Expressions".</p>
</div>
<div class="paragraph">
<p>Next, we&#8217;ll introduce and compare two popular JavaScript solutions and modularization patterns - CommonJS and Asynchronous Module Definition (AMD), which are alternative approaches to modularization. Both CommonJS and AMD are specifications defining sets of APIs.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll learn pros and cons of both formats later in the chapter, but the AMD module format plays nicely with the asynchronous nature of Web. You&#8217;ll also see the use of the AMD module format and <a href="http://requirejs.org/">RequireJS</a> framework to implement the modularized version of the Save The Child application.</p>
</div>
<div class="paragraph">
<p>Also, you&#8217;ll see how to use the RequireJS APIs to implement on-demand ("<em>lazy</em>") loading of the application components (e.g. What We Do, Ways To Give et al.)</p>
</div>
<div class="paragraph">
<p>The upcoming ECMAScript 6 specification suggests how to handle modules, and how to start using ES6 module syntax today with the help of third-party tools like <a href="http://corner.squareup.com/2013/02/es6-module-transpiler.html">transpiler</a>. The ES6 module syntax can be compiled down to existing module solutions like CommonJS or AMD. You can find more details about CommonJS, AMD and the ES6 module format in the corresponding sections of this chapter.</p>
</div>
<div class="paragraph">
<p>After application modules are asynchronously loaded, they need to communicate to each other. You can explicitly specify the components dependencies, which is fine as long as you have a handful of  components. A more generic approach is to handle inter-module communications in a loosely coupled fashion using the <em>Mediator</em> pattern, CommonJS or AMD formats. By <em>loosely coupled</em> we mean that components are not aware of each other&#8217;s existence.</p>
</div>
<div class="paragraph">
<p>The next section reviews various approaches and patterns of modular JavaScript applications.</p>
</div>
</div>
<div class="sect2">
<h3 id="_roads_to_modularization">Roads To Modularization</h3>
<div class="paragraph">
<p>Although JavaScript has no build-in language support of modules, the developers' community has managed to find a way for modularization using existing syntax constructs, libraries and conventions to emulate modules-like behavior. In this section, we&#8217;ll explore a few options for modularizing your application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Module Pattern</p>
</li>
<li>
<p>CommonJS</p>
</li>
<li>
<p>Asynchronous Module Definition (AMD)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Of these three, the <em>Module pattern</em> doesn&#8217;t require any additional frameworks and works in any JavaScript environment. The <em>CommonJS</em> module format is widely adopted for the server-side JavaSctipt, while the <em>AMD</em> format is popular in the applications running in Web browsers.</p>
</div>
<div class="sect3">
<h4 id="_the_module_pattern">The Module Pattern</h4>
<div class="paragraph">
<p>In software engineering, the Module pattern was originally defined as a way to implement encapsulation of reusable code. In JavaScript, the Module pattern is used to emulate the concept of classes. We&#8217;re able to include both public and private methods as well as variables inside the single object, thus hiding the encapsulated code from other global scope objects. Such encapsulation lowers the likelihood of conflicting function names defined in different scripts that could be used in the same application&#8217;s scope.</p>
</div>
<div class="paragraph">
<p>Ultimately, it&#8217;s just some code in an IIFE that creates a module object in the internal scope of a function and exposes this module to the global scope using the JavaScript language syntax. Consider the following three code samples illustrating how the Module pattern could be implemented using IIFEs.</p>
</div>
<div class="listingblock">
<div class="title">Returning the value from a module</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">var loginModule = (function() {     <i class="conum" data-value="1"></i><b>(1)</b>
    "use strict";

    var module = {};
    var privateVariable = 42;

    var privateLogin = function(userNameValue, userPasswordValue) {     <i class="conum" data-value="2"></i><b>(2)</b>
        if (userNameValue === "admin" &amp;&amp; userPasswordValue === "secret") {
            return privateVariable;
        }
    };

    module.myConstant = 1984;
    module.login = function(userNameValue, userPasswordValue) {
        privateLogin(userNameValue, userPasswordValue);
        console.log("login implementation omitted");
    };

    module.logout = function() {
        console.log("logout implementation omitted");
    };

    return module;
})();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Assigning the module object that was created in the closure to the variable <code>loginModule</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Because of the JavaScript&#8217;s function scoping, other parts of the code can&#8217;t access the code inside the closure. With this approach you can implement encapsulation and private members.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Injecting the module into the global object</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">(function(global) {     <i class="conum" data-value="1"></i><b>(1)</b>
    "use strict";
    var module = {};

    var privateVariable = 42;
    var privateLogin = function(userNameValue, userPasswordValue) {
        if (userNameValue === "admin" &amp;&amp; userPasswordValue === "secret") {
            return privateVariable;
        }
    };

    module.myConstant = 1984;
    module.login = function(userNameValue, userPasswordValue) {
        privateLogin(userNameValue, userPasswordValue);
        console.log("rest of login implementation is omitted");
    };

    module.logout = function() {
        console.log("logout implementation omitted");
    };

    global.loginModule = module;
})(this);  <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Instead of exporting the module to a variable as in the previous example, we&#8217;re passing the global object as a parameter inside the closure.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Attaching the newly created object to the global object. After that the <code>loginModule</code> object can be accessed from the external application code as <code>window.loginModule</code> or just <code>loginModule</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Introducing namespaces in the global object</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">(function(global) {
    "use strict";

    var ssc = global.ssc;   <i class="conum" data-value="1"></i><b>(1)</b>
    if (!ssc) {
        ssc = {};
        global.ssc = ssc;
    }

    var module = ssc.loginModule = {};  <i class="conum" data-value="2"></i><b>(2)</b>

    module.myConstant = 1984;
    module.login = function(userNameValue, userPasswordValue) {
        console.log("login implementation omitted");
    };

    module.logout = function() {
        console.log("logout implementation omitted");
    };
})(window);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here we have modification of the approach described in previous snippet. To avoid name conflicts, create a namespace for our application called <code>ssc</code>. Note that we check for this object existence in the next line.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Now we can logically structure application code using namespaces. The global <code>ssc</code> object will contain only the code related to the Save The Child application.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Module patterns works well for implementing encapsulation in a rather small applications. It&#8217;s easy to implement and is framework-agnostic. However this approach doesn&#8217;t scale well because when working with an application with the large number of modules you may find yourself adding lots of boilerplate code checking objects' existence in the global scope for each new module. Also, you need to be careful with managing namespaces: since you are the one who put an object into the global scope, you need to think  how to avoid accidental names conflicts.</p>
</div>
<div class="paragraph">
<p>The Module pattern has a serious drawback - you  still need to deal with manual dependency management and manually arrange <code>&lt;script&gt;</code> tags in the HTML document.</p>
</div>
</div>
<div class="sect3">
<h4 id="_commonjs">CommonJS</h4>
<div class="paragraph">
<p><a href="http://www.commonjs.org/">CommonJS</a> is an effort to standardize JavaScript APIs. People who work on CommonJS APIs have attempted to develop standards for both modules and packages. The CommonJS module proposal specifies a simple API for declaring modules, but mainly on the server-side. The CommonJS module format was optimized for non-browser environments since the early days of the server-side JavaScript.</p>
</div>
<div class="paragraph">
<p>On the Web browser side, you always need to consider potentially slow HTTP communications, which is not the case on the server. One of the solutions suitable for browsers is to concatenate all scripts into a handful of bundles to decrease the number of HTTP calls, which was not a concern for the server-side JavaScript engines because file access is nearly instantaneous. On the server side separation of the code allowed to dedicate each file to exactly one module for ease development, testing and maintainability.</p>
</div>
<div class="paragraph">
<p>In brief, the CommonJS specification requires the environment to have  <a href="http://wiki.commonjs.org/wiki/Modules/1.1#Module_Context">three free variables</a>: <code>require</code>, <code>exports</code>, and <code>module</code>. The syntax to define the module is called <em>authoring format</em>. To make the module loadable by a Web browser it has to be transformed into <em>transport format</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">"use strict";
var loginModule = {};
var privateVariable = 42;

var ldapLogin = require("login/ldap");      <i class="conum" data-value="1"></i><b>(1)</b>
var otherImportantDep = require("modules/util/strings"); <i class="conum" data-value="1"></i><b>(1)</b>

var privateLogin = function(userNameValue, userPasswordValue) {
    if (userNameValue === "admin" &amp;&amp; userPasswordValue === "secret") {
        ldapLogin.login(userNameValue, userPasswordValue);
        return privateVariable;
    }
};

loginModule.myConstant = 1984;
loginModule.login = function(userNameValue, userPasswordValue) {
    privateLogin(userNameValue, userPasswordValue);
    console.log("login implementation omitted");
};

loginModule.logout = function() {
    console.log("logout implementation omitted");
};

exports.login = loginModule;        <i class="conum" data-value="2"></i><b>(2)</b>
// or
module.exports = loginModule;      <i class="conum" data-value="3"></i><b>(3)</b>

loginModule.printMetadata = function(){
    console.log(module.id);     <i class="conum" data-value="3"></i><b>(3)</b>
    console.log(module.uri);
};</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If a module requires other modules, declare references to those modules inside the current module&#8217;s scope by using the <code>require</code> function. You need to call <code>require(id)</code> for each module it  depends on.  The module id has slashes defining the file path or a URL to indicate namespaces for external modules. Modules are grouped into a packages.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>exports</code> object exposes the public API of a module. All objects, functions, constructors that your module exposes must be declared as properties of the <code>exports</code> object. The rest of the module&#8217;s code won&#8217;t be exposed.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>module</code> variable provides the metadata about the module. It holds such properties as <code>id</code> and a unique <code>uri</code> of each module. The <code>module.export</code> exposes <code>exports</code> object as its property. Because objects in JavaScript are passed as references, the <code>exports</code> and <code>module.exports</code> point at the same object.</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
The snippet above may give you an impression that the module&#8217;s code is executed in the global scope, but it&#8217;s not. Each module is executed in its own scope which helps to isolate them. This works automatically when you write modules for NodeJS environment running on the server (see Chapter 8). But to use CommonJS module format in the Web browser you need to use an extra tool to generate transport format from <em>authoring format</em>. <a href="http://browserify.org/">Browserify</a> takes all your scripts and concatenates them it to one large file.  Besides the module&#8217;s code the generated transport bundle will contain the boilerplate code that provides CommonJS modules runtime support in the browser environment. This build step complicates the development workflow. Usually developers perform the <em>code/save/refresh browser</em> routine, but it doesn&#8217;t work in this case and requires an extra steps as you need to install the additional build tool and write  build scripts.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="underline">Pros to using CommonJS:</span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s a simple API for writing and using modules.</p>
</li>
<li>
<p>Such a pattern of organizing  modules is widespread in the server-side JavaScript, e.g. NodeJS.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="underline">Cons to using CommonJS:</span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Web browsers don&#8217;t automatically create the scoped variables <code>require</code>, <code>exports</code>, <code>module</code> hence the additional build step is required.</p>
</li>
<li>
<p>The <code>require</code> method is synchronous, but there is no exact indication if dependent module&#8217;s values are fully loaded because of the asynchronous nature of Web browsers. There is no event to notify the application that 100% of the required resources is loaded.</p>
</li>
<li>
<p>CommonJS API is suitable for loading <code>.js</code> files, but it can&#8217;t load other assets like CSS and HTML.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
If you want to write modules in the format that can be used in both browser and server&#8217;s  environments read our suggestions in the  <a href="#umd">Universal Module Definition</a> section on this chapter.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Further reading:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://wiki.commonjs.org/wiki/Modules/1.1">CommonJS Modules 1.1 specification</a></p>
</li>
<li>
<p><a href="http://nodejs.org/docs/latest/api/modules.html#modules_modules">Node.js Modules Reference</a></p>
</li>
<li>
<p><a href="http://browserify.org/">Browserify</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="amd_section">Asynchronous Module Definition</h4>
<div class="paragraph">
<p>The AMD module format itself is a proposal for defining modules where both the module and dependencies can be asynchronously loaded.
The AMD API is based on <a href="https://github.com/amdjs/amdjs-api/wiki/AMD">this specification</a>.</p>
</div>
<div class="paragraph">
<p>AMD began as a draft specification for module format in CommonJS, but since the full agreement about its content was not reached, the further work on module&#8217;s format moved to the <a href="https://github.com/amdjs">amdjs Github page</a>.</p>
</div>
<div class="paragraph">
<p>The AMD API have the following main functions:</p>
</div>
<div id="DEFINE_DESC" class="ulist">
<ul>
<li>
<p><code>define</code> for facilitating module definition. This function takes tree arguments:</p>
<div class="ulist">
<ul>
<li>
<p>The optional module id</p>
</li>
<li>
<p>An optional array of modules' IDs of dependencies</p>
</li>
<li>
<p>A callback function (a.k.a <em>factory function</em>), which will be invoked when dependencies are loaded.</p>
<div id="LISTING_define_func" class="listingblock">
<div class="title">The signature of a <code>define</code> function</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">define(
    module_id,          <i class="conum" data-value="1"></i><b>(1)</b>
    [dependencies],     <i class="conum" data-value="2"></i><b>(2)</b>
    function {}
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This string literal defines <code>module_id</code> that will be used by the AMD loader for loading this module.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An optional array of dependencies' ids.</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The factory <code>function{}</code> above will only be executed once.</p>
</div>
<div class="paragraph">
<p>For example, the Save The Child application has a menu Way To Give, which in turn depends on other module called <code>otherContent</code>. If the user clicks on this menu, we can load the module that can be defined in the <code>wayToGive.js</code> as follows:</p>
</div>
<div id="LISTING_define_modeule" class="listingblock">
<div class="title">The definition of the wayToGive module</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">define(["otherContent"], function(otherContent) { <i class="conum" data-value="1"></i><b>(1)</b>
    var wayToGive;

    console.log("otherContent module is loaded");
    wayToGive = function() {
        return {
            render: function() {
                var dataUrl, newContainerID, whatWeDoButton;

                whatWeDoButton = "way-to-give";
                newContainerID = "way-to-give-container";
                dataUrl = "assets/html-includes/way-to-give.html";
                otherContent.getNewContent(whatWeDoButton, newContainerID, dataUrl); <i class="conum" data-value="2"></i><b>(2)</b>
                return console.log("way-to-give module is rendered");
            },
            init: function() {
                return console.log("way-to-give init");
            }
        };
    };
    return wayToGive; <i class="conum" data-value="3"></i><b>(3)</b>
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This code doesn&#8217;t have the optional <code>module_id</code>. The loader will use the file name without the <code>.js</code> extension as <code>module_id</code>. Our module has one dependency on the module called <code>otherContent</code>. The dependent module instance will be passed in the factory method as variable <code>otherContent</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We can start using the dependency object immediately. AMD loader have taken care of loading and instantiation of this dependency.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The module returns constructor function to be used for creation of new objects.</td>
</tr>
</table>
</div>
<div id="REQUIRE_DESC" class="ulist">
<ul>
<li>
<p>The <code>require</code> function takes two arguments</p>
<div class="ulist">
<ul>
<li>
<p>An array of module IDs to load. Module ID is a string literal.</p>
</li>
<li>
<p>A callback to be executed once those modules are available. The modules loaded by IDs are passed into the callback in order. <a href="#LISTING_Require_func">Here is example</a> of the <code>require</code> function usage.</p>
<div id="LISTING_require_func" class="listingblock">
<div class="title">The example of <code>require</code> function usage</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">require(["main"], function() {
    console.log("module main is loaded");
});</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="underline">Pros to using AMD:</span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s a very simple API that has only two functions - <code>require</code> and <code>define</code>.</p>
</li>
<li>
<p>A wide variety of loaders is available. You&#8217;ll find more coverage on loaders in the <a href="#REQUIREJS">RequireJS section</a>.</p>
</li>
<li>
<p>A CommonJS module authoring format is supported by the majority of loaders. You&#8217;ll see an example of modules later in the <a href="#require_cjs">Using CommonJS module format in RequireJS</a> section.</p>
</li>
<li>
<p>Plugins offer an immense amount of flexibility.</p>
</li>
<li>
<p>AMD is easy to debug.</p>
<div class="paragraph">
<p>Consider the following error messages that JavaScript interpreter may throw:</p>
</div>
<div class="paragraph">
<p><em>There was an error in <code>/modules/loginModule.js</code> on line</em> <strong>42</strong></p>
</div>
<div class="paragraph">
<p><strong>vs</strong></p>
</div>
<div class="paragraph">
<p><em>There was an error in <code>/built-app.js</code> on line</em> <strong>1984</strong></p>
</div>
<div class="paragraph">
<p>In modularized applications you can easier localize errors.</p>
</div>
</li>
<li>
<p>Performance: module are loaded only when required hence the initial portion of the application&#8217;s code become smaller.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="underline">Cons to using AMD:</span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The dependency array can get rather large for complex modules.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">define(
       ["alpha", "beta", "gamma", "delta", "epsilon", "omega"], <i class="conum" data-value="1"></i><b>(1)</b>
       function(alpha, beta, gamma, delta, epsilon, omega){
            "use strict";
            // module's code omitted
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In the real-world enterprise applications the array of dependency modules might be pretty large.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Human errors can result in mismatch between dependency array and callback arguments.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">define(
       ["alpha", "beta", "gamma", "delta", "epsilon", "omega"],
       function(alpha, beta, gamma, delta, omega, epsilon){     <i class="conum" data-value="1"></i><b>(1)</b>
            "use strict";
            // module's code omitted
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The mismatch of module IDs and factory function arguments will cause module usage problems.</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="umd">Universal Module Definition</h4>
<div class="paragraph">
<p>Universal Module Definition (UMD) is a series of patterns and code snippets that provide compatibility boilerplate to make modules environment-independent. Those patterns can be used to support multiple module formats. UMD is not a specification or a standard. You need to pay attention to UMD patterns in case when your modules will run in more than one type of environment (e.g. a Web browser and on the server side engine running NodeJS). In most cases, it makes a lot of sense to use a single module format.</p>
</div>
<div class="paragraph">
<p>Here is an example of the module definition in UMD notation. In the following example, the module can be used with the AMD loader and as one of the variations of the Module Pattern.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">(function(root, factory) {
    "use strict";
    if (typeof define === "function" &amp;&amp; define.amd) { <i class="conum" data-value="1"></i><b>(1)</b>
        define(["login"], factory);
    } else {
        root.ssc = factory(root.login); <i class="conum" data-value="2"></i><b>(2)</b>
    }
}(this, function(login) { <i class="conum" data-value="3"></i><b>(3)</b>
    "use strict";
    return {
        myConstant: 1984,
        login: function(userNameValue, userPasswordValue) {
            console.log("login for " + userNameValue + " and " + userPasswordValue);
        },
        logout: function() {
            console.log("logout implementation omitted");
        }
    };
}));</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If the AMD loader is available proceed with defining the module according to AMD specification.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If the AMD loader isn&#8217;t present, use the factory method to instantiate the object and attach it to the <code>window</code> object.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Passing the top-level context and providing a implementation of a factory function.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can find more information about UMD and commented code snippets for different situations in <a href="https://github.com/umdjs/umd">the UMD project repository</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ecmascript_6_modules">ECMAScript 6 Modules</h4>
<div class="paragraph">
<p>The ECMAScript 6 (ES6) specification is an evolving draft outlining changes and features for the next version of the JavaScript language. This specification is not finalized yet and the browsers' support for anything defined in ES6 will be experimental at best and cannot be relied upon for Web applications that must be deployed in production mode in multiple browsers.</p>
</div>
<div class="paragraph">
<p>One of the most important features of ES6 specification is the <em>module syntax</em>. Here is an example of some login module definition:</p>
</div>
<div class="listingblock">
<div class="title">Login module definition</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">export function login(userNameValue, userPasswordValue) {
    console.log("login implementation omitted");
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>The keyword <code>export</code> specifies the function or object (a separate file) to be exposed as a module, which can be used from any other JavaScript code as follows:</p>
</div>
<div class="listingblock">
<div class="title">Main application module</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">import login from 'login'
var result = login("admin", "password");</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the <code>import</code> keyword we assign instance of <code>login()</code> function imported from <code>login</code> module.</p>
</div>
<div class="sect4">
<h5 id="_es6_module_transpiler">ES6 Module Transpiler</h5>
<div class="paragraph">
<p>Although ES6 standard is not implemented yet by most of browsers you can use the third party tools to get a taste of upcoming enhancements in JavaScript language. <a href="http://corner.squareup.com/2013/02/es6-module-transpiler.html">ES6 Module Transpiler</a> library developed by the <a href="http://squareup.com/">Square</a> Engineers helps using the module authoring syntax from ES6 and compile it down to the transport formats that you learned earlier in this chapter.</p>
</div>
<div class="paragraph">
<p>Consider the following module circle.js:</p>
</div>
<div class="listingblock">
<div class="title">A <code>circle.js</code> module</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">export function area(radius) {
  return Math.PI * radius * radius;
}

export function circumference(radius) {
  return 2 * Math.PI * radius;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This module exports two functions: <code>area()</code> and <code>circumference()</code>.</p>
</div>
<div class="listingblock">
<div class="title">The main application&#8217;s script <code>main.js</code> can use these functions</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">import { area, circumference } from 'circle';     <i class="conum" data-value="1"></i><b>(1)</b>

console.log("Area of the circle: " + area(2) + " meter squared");   <i class="conum" data-value="2"></i><b>(2)</b>
console.log("Circumference of the circle: " + circumference(5) + " meters");</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>import</code> keyword specifies the objects we want to use from the module.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A sample use of the imported functions</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The ES6 Module Transpiler&#8217;s command <code>compile-module</code> can compile the module to be compliant with CommonJS, AMD, or the code that implements the Module pattern. With the <code>type</code> command line option you can specify that output format will be: <em>amd</em>, <em>cjs</em> and <em>globals</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>compile-modules circle.js --type cjs --to ../js/
compile-modules main.js --type cjs --to ../js/</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CommonJS</strong> format</p>
<div class="listingblock">
<div class="title">circle.js</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">"use strict";

function area(radius) {
    return Math.PI * radius * radius;
}

function circumference(radius) {
    return 2 * Math.PI * radius;
}
exports.area = area;
exports.circumference = circumference;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">main.js</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">"use strict";
var __dependency1__ = require("circle");
var area = __dependency1__.area;
var circumference = __dependency1__.circumference;

console.log("Area of the circle: " + area(2) + " meter squared");
console.log("Circumference of the circle: " + circumference(5) + " meters");</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Should we compiled the modules into the AMD format using the option <em>amd</em>, we would have received a different output in the AMD format.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>AMD</strong> format</p>
<div class="listingblock">
<div class="title">circle.js</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">define("circle", ["exports"],
    function(__exports__) {
        "use strict";

        function area(radius) {
            return Math.PI * radius * radius;
        }

        function circumference(radius) {
            return 2 * Math.PI * radius;
        }
        __exports__.area = area;
        __exports__.circumference = circumference;
    });</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">main.js</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">define("main", ["circle"],
    function(__dependency1__) {
        "use strict";
        var area = __dependency1__.area;
        var circumference = __dependency1__.circumference;

        console.log("Area of the circle: " + area(2) + " meter squared");
        console.log("Circumference of the circle: " + circumference(5) + " meters");

    });</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the <em>globals</em> option in the <em>compile-modules</em> command line produces the code that can be used as described in the Module Patter section earlier in the chapter.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Browser globals</p>
<div class="listingblock">
<div class="title">circle.js</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">(function(exports) {
    "use strict";

    function area(radius) {
        return Math.PI * radius * radius;
    }

    function circumference(radius) {
        return 2 * Math.PI * radius;
    }
    exports.circle.area = area;
    exports.circle.circumference = circumference;
})(window);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">main.js</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">(function(circle) {
    "use strict";
    var area = circle.area;
    var circumference = circle.circumference;

    console.log("Area of the circle: " + area(2) + " meter squared");
    console.log("Circumference of the circle: " + circumference(5) + " meters");

})(window.circle);
</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To learn the up-to-date information on the ES6 browsers' support visit <a href="http://kangax.github.io/es5-compat-table/es6/">ECMAScript 6 compatibility table</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<a href="http://www.typescriptlang.org/">TypeScript</a> is an open-source language from Microsoft that compiles to JavaScript and brings object-oriented concepts like classes and modules to JavaScript. It has a module syntax, which is very similar to what ES6 standard proposes. The TypeScript compiler can produce CommonJS and AMD module formats. You can learn more about TypeScript from <a href="http://www.typescriptlang.org/Content/TypeScript%20Language%20Specification.pdf">language specification</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="REQUIREJS">Dicing the Save The Child Application Into Modules</h3>
<div class="paragraph">
<p>Now that you know the basics of AMD and different modularization patterns, let&#8217;s see how you can dice our Save The Child application into smaller pieces. In this section we&#8217;ll apply the AMD-complaint module loader from the framework <a href="http://requirejs.org/">RequireJS</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<a href="http://github.com/cujojs/curl">curl.js</a> offers  another AMD-compliant asynchronous resource loader. Both curl.js and RequireJS have similar functionality, and to learn how they differ follow <a href="https://groups.google.com/forum/#!topic/requirejs/niUyLZrivgs">this thread on RequireJS group</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a brief explanation of the directory structure of the modularized Save The Child application.</p>
</div>
<div id="ssc_structure" class="imageblock" style="text-align: center">
<div class="content">
<img src="./images/fig_07_05.png" alt="fig 07 05">
</div>
<div class="title">Figure 2. A directory structure of Save The Child</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All application&#8217;s JavaScript files reside in the <em>app/modules</em> directory.</p>
<div class="paragraph">
<p>Inside the <em>modules</em> directory you can have as many nested folders as you want, e.g. <em>utils</em> folder.</p>
</div>
</li>
<li>
<p>The application assets remain the same as in previous chapters.</p>
</li>
<li>
<p>We keep all Bower-managed dependencies in the <em>bower_components</em> directory such as  RequireJS, jQuery etc.</p>
</li>
<li>
<p>The <em>dist</em>  directory serves as the location for the optimized version of our application. We will cover optimization with <code>r.js</code> later in the <a href="#using_reuiqrejs_optimizer">Using RequireJS Optimizer</a> section.</p>
</li>
<li>
<p>The QUnit/Jasmine tests will live in the <em>test</em> directory. Testing will be covered in Chapter 8.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We are not going to dice the Save The Child application into multiple modules, but will just show you how to start this process. <a href="#ssc_modules_graph">The modules graph of Save The Child</a> illustrates the modules' dependencies. For example, the <code>main</code> module depends on <code>login</code>, <code>svg-pie-chart</code>, <code>campaigns-map</code>, <code>donation</code>, and <code>generic</code>. There is also a group of modules that will be loaded on demand: <code>whereWeWork</code>, <code>whatWeDo</code>, <code>wayToGive</code>, <code>whoWeAre</code>.</p>
</div>
<div id="ssc_modules_graph" class="imageblock" style="text-align: center">
<div class="content">
<img src="./images/fig_07_08.png" alt="fig 07 08">
</div>
<div class="title">Figure 3. The modules graph of Save The Child</div>
</div>
<div class="paragraph">
<p>To dice the application into modules you&#8217;ll need the the modularization framework RequireJS, which can either be downloaded from its github repository or you can install it using a package manager Bower that was explained in previous chapter on automation tools.</p>
</div>
<div class="paragraph">
<p>Once RequireJS downloaded and placed into the project directory, add it to the index.html file as demonstrated in <a href="#add_requirejs">Adding RequireJS to the web page</a> snippet.</p>
</div>
<div id="add_requirejs" class="listingblock">
<div class="title">Adding RequireJS to the web page</div>
<div class="content">
<pre class="highlight"><code class="html language-html">&lt;!DOCTYPE html&gt;
&lt;head&gt;
    &lt;!-- content omitted --&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;!-- page body --&gt;

&lt;script src="components/requirejs/require.js"
        data-main="app/config"&gt;&lt;/script&gt; <i class="conum" data-value="1"></i><b>(1)</b>

&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div id="data_main_attrib" class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Once the RequireJS library is loaded it will look for the <code>data-main</code> attribute and attempt to load the <code>app/config.js</code> script asynchronously. The <code>app/config.js</code> will become the entry point of our application.</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="inside_config">Inside RequireJS configuration: config.js</h4>
<div class="paragraph">
<p>RequiredJS uses a configuration object that includes modules and dependencies that have to be managed by the framework.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">require.config({        <i class="conum" data-value="1"></i><b>(1)</b>
    paths: {            <i class="conum" data-value="2"></i><b>(2)</b>
        'login': 'modules/login',
        'donation': 'modules/donation',
        'svg-pie-chart': 'modules/svg-pie-chart',
        'campaigns-map': 'modules/campaigns-map',
        'showHideDiv': 'modules/utils/show-hide-div',
        'loadHtmlContent': 'modules/utils/load-html-content',
        'newContentLoader': 'modules/utils/new-content-loader',
        'who-we-are': 'modules/who-we-are',
        'what-we-do': 'modules/what-we-do',
        'where-we-work': 'modules/where-we-work',
        'way-to-give': 'modules/way-to-give',
        'components': '../components',
        'jquery': '../components/jquery/jquery',
        'main': 'main',
        'GoogleMap': '../components/GoogleMap/dist/GoogleMap'
    }
});

require(['main'], function() {}); <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="http://requirejs.org/docs/api.html#config">RequireJS documentation</a> has a comprehensive overview of all configuration options. We&#8217;ve included some of them here.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>paths</code> configuration option defines the mapping for module names and their paths. The <code>paths</code> is used for module names and shouldn&#8217;t contain file extensions.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>After configuring the modules' paths we&#8217;re loading the <em>main</em> module. The navigation of our application flow starts there.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_writing_amd_modules">Writing AMD Modules</h4>
<div class="paragraph">
<p>Let&#8217;s take a closer look at the module&#8217;s internals that make it consumable by the RequireJS module loader.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">define(["newContentLoader"], function(contentLoader) {      <i class="conum" data-value="1"></i><b>(1)</b>
    "use strict";
    var genericModule;

    genericModule = function(moduleId) {    <i class="conum" data-value="2"></i><b>(2)</b>
        return {
            render: function(button, containerId, dataUrl) {
                contentLoader.getNewContent(button, containerId, dataUrl);  <i class="conum" data-value="3"></i><b>(3)</b>
                console.log("Module " + moduleId + " is rendered...");
            }
        };
    };
    return genericModule;
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>As we discussed in the <a href="#amd_section">Asynchronous Module Definition</a> section, the code that you want to expose as a module should be wrapped in the <code>define()</code> function call. The first parameter is an array of dependencies. The location of dependencies files is defined <a href="#inside_config">inside the config file</a>. The dependency object doesn&#8217;t have the same name as the dependency string id. The order of arguments in the factory function should be the same as the order in the dependencies array.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In this module we export only in the constructor function that returns the object that uses the <em>render</em> function to draw the visual component on the screen.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>contentLoader</code> object loaded from <em>app/modules/util/new-content-loader.js</em> (see the <code>paths</code> property <a href="#inside_config">in RequireJS config object</a>), is instantiated by RequireJS and is ready to use.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>RequreJS also supports the CommonJS module format with a slightly different signature of the <code>define()</code> function. This helps to bridge the gap between AMD and CommonJS. If your factory function accepts parameters but no dependency array, the AMD environment assumes that you wish to emulate the  CommonJS module environment. The standard <code>require</code>, <code>exports</code>, and <code>module</code> variables will be injected as parameters into the factory.</p>
</div>
<div class="paragraph">
<p>Here is an example of CommonJS module format with RequireJS.</p>
</div>
<div id="require_cjs" class="listingblock">
<div class="title">Using CommonJS module format in RequireJS</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">define(function(require, exports, module) { <i class="conum" data-value="1"></i><b>(1)</b>
    "use strict";
    module.exports = (function() {      <i class="conum" data-value="2"></i><b>(2)</b>

        var dependency = require("dependencyId");   <i class="conum" data-value="3"></i><b>(3)</b>

        function AuctionDTO(_arg) {
            this.auctionState = _arg.auctionState;
            this.item = _arg.item;
            this.bestBid = _arg.bestBid;
            this.auctionId = _arg.auctionId;
            dependency.doStuff();
        }

        AuctionDTO.prototype.toJson = function() {
            return JSON.stringify(this);
        };

        return AuctionDTO;
    })();
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The factory receives up to three arguments that emulate the CommonJS <code>require</code>, <code>exports</code>, and <code>module</code> variables.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Export your module rather than returning it. You can export an object in two ways - assign the the module directly to <code>module.exports</code> as shown in this snippet, or set the  properties on the <code>exports</code> object.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>In CommonJS, dependencies are assigned to local variables using the <code>require(id)</code> function.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_loading_modules_on_demand">Loading Modules On-Demand</h4>
<div class="paragraph">
<p>As per the Save The Child modules graph, some components shouldn&#8217;t load when the application starts. Similar to Mercedes Benz website example, some functionality of Save The Child can be loaded later when user needs it. The user might never want to visit the "Where we work" section. Hence this functionality is a good candidate for the <em>load on-demand</em> module. You may want to load such a module on demand when the user clicks the button or selects a menu item.</p>
</div>
<div class="paragraph">
<p>At any given time a module can be in one of three states:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>not loaded (<code>module === null</code>)</p>
</li>
<li>
<p>loading is in progress (<code>module === 'loading'</code>)</p>
</li>
<li>
<p>fully loaded (<code>module !== null</code>).</p>
</li>
</ul>
</div>
<div id="load_ondemand_snippet" class="listingblock">
<div class="title">Loading the module on demand</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">var module;
var buttonClickHandler = function(event) {
    "use strict";
  if (module === "loading") {       <i class="conum" data-value="1"></i><b>(1)</b>
    return;
  }
  if (module !== null) {        <i class="conum" data-value="2"></i><b>(2)</b>
    module.render();
  } else {
    module = "loading";         <i class="conum" data-value="3"></i><b>(3)</b>
    require(["modules/wereWeWork"], function(ModuleObject) { <i class="conum" data-value="4"></i><b>(4)</b>
      module = new ModuleObject();
      module.render();
    });
  }
};</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Checking if module loading in progress.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Don&#8217;t re-load the same module. If the module was already loaded just call the method to render the widget on the Web page.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Setting the module into the intermediate state until it&#8217;s fully loaded.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Once the <code>whereWeWork</code> module is loaded, the callback will receive the reference to this module - instantiate <code>whereWeWork</code> and render it on the page.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s apply the technique demonstrated in <a href="#load_ondemand_snippet">Loading the module on demand</a> snippet for Save The Child application to lazy load the "Who We Are", "What We Do", "Where We Work" and "What To Give" modules only if the user clicked on the corresponding top bar link.</p>
</div>
<div class="listingblock">
<div class="title">The Main Module</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">define(["order!login",
        "order!donation",
        "order!svg-pie-chart",
        "modules/generic-module"],
        function() { <i class="conum" data-value="1"></i><b>(1)</b>
            "use strict";
            return (function() {
                var initModule, lazyLoadingEventHandlerFactory,
                module, modulesConfig, way_to_give,
                what_we_do, where_we_work, who_we_are, _i, _len;

                way_to_give = document.getElementById("way-to-give");
                what_we_do = document.getElementById("what-we-do");
                who_we_are = document.getElementById("who-we-are");
                where_we_work = document.getElementById("where-we-work");
                modulesConfig = [{      <i class="conum" data-value="2"></i><b>(2)</b>
                    moduleId: "whoWeAre",
                    button: who_we_are,
                    containerId: "who-we-are-container",
                    htmlContentUrl: "assets/html-includes/who-we-are.html"
                }, {
                    moduleId: "whatWeDo",
                    button: what_we_do,
                    containerId: "what-we-do-container",
                    htmlContentUrl: "assets/html-includes/what-we-do.html"
                }, {
                    moduleId: "whereWeWork",
                    button: where_we_work,
                    containerId: "where-we-work-container",
                    htmlContentUrl: "assets/html-includes/where-we-work.html"
                }, {
                    moduleId: "wayToGive",
                    button: way_to_give,
                    containerId: "way-to-give-container",
                    htmlContentUrl: "assets/html-includes/way-to-give.html"
                }];
                lazyLoadingEventHandlerFactory = function(moduleId, containerId, htmlContentPath) { <i class="conum" data-value="3"></i><b>(3)</b>
                    return function(event) {
                        var module;

                        if (module === "loading") {
                            return;
                        }
                        if (typeof module !== "undefined" &amp;&amp; module !== null) {
                            return module.render(event.target.id, containerId, htmlContentPath);
                        } else {
                            module = "loading";
                            return require(["modules/generic-module"], function(GenericModule) {
                                module = new GenericModule(moduleId);
                                return module.render(event.target.id, containerId, htmlContentPath);
                            });
                        }
                    };
                };

                initModule = function(module) {     <i class="conum" data-value="4"></i><b>(4)</b>
                    var handler;

                    handler = lazyLoadingEventHandlerFactory(module.moduleId,
                              module.containerId, module.htmlContentUrl);
                    return module.button.addEventListener("click", handler, false);
                };

                for (_i = 0, _len = modulesConfig.length; _i &lt; _len; _i++) {    <i class="conum" data-value="5"></i><b>(5)</b>
                    module = modulesConfig[_i];
                    initModule(module);
                }
                console.log("app is loaded");
            })();
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The first argument of the <code>define</code> function is an array of dependencies. The <code>!</code> sign in the module id string literals means that RequireJS delegates some work to a  plugin such as <code>order</code> in our example. This plugin enforces the loading order. We will talk about RequireJS plugins later in this chapter in the <a href="#requirejs_plugins">RequireJS plugins</a> section.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An array of modules that can be loaded on demand.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Here we&#8217;re using the approach described in the <a href="#load_ondemand_snippet">Loading the module on demand</a> section. This factory function produces the handler for the button click event. It uses RequireJS API to load the module once the  user clicked on the button.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Instantiate the click handler function using <code>lazyLoadingEventHandlerFactory</code> and assign it to the button defined in the module config.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>In the last step, we need to initialize each module button with the lazy loading handler.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="requirejs_plugins">RequireJS plugins</h4>
<div class="paragraph">
<p>RequireJS plugins are special modules that implement specific API. For example, the <em>text</em> plugin allows to specify a text file as a dependency, <em>cs!</em> translates <em>CoffeeScript</em> files into JavaScript. The plugin&#8217;s module name comes before the <em>!</em> separator. Plugins can extend the default loader&#8217;s functionality.</p>
</div>
<div class="paragraph">
<p>In the Save The Child application we use the <em>order.js</em> plugin that allows to specify the exact order in which the dependencies should be loaded. You can find the full list of the available RequireJS plugins at the following <a href="https://github.com/jrburke/requirejs/wiki/Plugins">wiki page</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using_reuiqrejs_optimizer">Using RequireJS Optimizer</h4>
<div class="paragraph">
<p>RequireJS comes with the optimization tool called <a href="http://requirejs.org/docs/optimization.html"><em>r.js</em></a>, which is a utility that performs module optimization.
Earlier in this chapter, we&#8217;ve specified the dependencies as an array of string literals that are passed to the top-level <a href="#REQUIRE_DESC">require</a> and <a href="#DEFINE_DESC">define</a> calls. The optimizer will combine modules and their dependencies into a single file based on these dependencies.</p>
</div>
<div class="paragraph">
<p>Furthermore, r.js integrates with other optimization tools like <code>UglifyJS</code> and <code>Closure Compiler</code> to minify the content of script files. We are going to use the JavaScript task runner <a href="http://gruntjs.com/">Grunt</a> that you learned in previous chapter on automation tools.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s configure our Grunt project to enable the optimization task. Here&#8217;s the command to install RequireJS, and Grunt&#8217;s task packages clean, concat and uglify and save them as development dependencies in the file package.json:</p>
</div>
<div class="listingblock">
<div class="title">Adding dependencies to package.json</div>
<div class="content">
<pre class="highlight"><code class="bash language-bash">&gt; npm install grunt-contrib-requirejs\
grunt-contrib-concat grunt-contrib-clean\
grunt-contrib-uglify --saveDev</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#rjs_gruntfile_list">The following listing</a> describes the script to setup RequireJS optimizer and the related optimization tasks for Grunt. You&#8217;ll need to run this script to generate optimized version of the Save The Child application.</p>
</div>
<div id="rjs_gruntfile_list" class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">"use strict";

module.exports = function (grunt) {

    // Project configuration.
    grunt.initConfig({
        // Task configuration.
        clean: {
            files: ["dist"] <i class="conum" data-value="1"></i><b>(1)</b>
        },
        requirejs: {        <i class="conum" data-value="2"></i><b>(2)</b>
            compile: {
                options: {
                    name: "config",
                    mainConfigFile: "app/config.js",
                    out: "&lt;%= concat.dist.dest %&gt;",
                    optimize: "none"
                }
            }
        },
        concat: {       <i class="conum" data-value="3"></i><b>(3)</b>
            dist: {
                src: ["components/requirejs/require.js", "&lt;%= concat.dist.dest %&gt;"],
                dest: "dist/require.js"
            }
        },
        uglify: {       <i class="conum" data-value="4"></i><b>(4)</b>
            dist: {
                src: "&lt;%= concat.dist.dest %&gt;",
                dest: "dist/require.min.js"
            }
        }
    });

    grunt.loadNpmTasks("grunt-contrib-clean");      <i class="conum" data-value="5"></i><b>(5)</b>
    grunt.loadNpmTasks("grunt-contrib-requirejs");
    grunt.loadNpmTasks("grunt-contrib-concat");
    grunt.loadNpmTasks("grunt-contrib-uglify");

    grunt.registerTask("default", ["clean", "requirejs", "concat", "uglify"]);  <i class="conum" data-value="6"></i><b>(6)</b>
};</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>clean</code> task cleans output directory. In the <code>files</code> section of task config we specify what folder should be cleaned.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>requirejs</code> task. The configuration properties of <code>requrejs</code> task are self-explanatory. <code>mainConfigFile</code> points at the same file that <a href="#data_main_attrib"><code>data-main</code> attribute</a> of RequireJS script tag. <code>out</code> parameter specifies output directory where optimized script will be created.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>concat</code> task combines/concatenates  optimized modules code and RequireJS loader code.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>uglify</code> task minifies provided files (see <code>src</code> properties) using <a href="http://lisperator.net/uglifyjs/">UglifyJS</a> - a compressor/minifier tool. UglifyJS produces significantly smaller version of the original script by reducing the <a href="http://en.wikipedia.org/wiki/Abstract_syntax_tree">Abstract Syntax Tree (AST)</a> and changing local variable names to single-letters.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Loading plugins that provide necessary tasks.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The default task to execute all tasks in order.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run the <a href="http://localhost:8080/ssc-requirejs">Save The Child</a> application built with RequireJS and monitor the network traffic in Chrome Developer Tools. You&#8217;ll see  many HTTP requests that load modules asynchronously. As you can see from the <a href="#unoptim_require_fig">from following screenshot</a>, 12 out of 14 browser&#8217;s requests are for loading all required modules. The modules that may be loaded on demand are not here.</p>
</div>
<div id="unoptim_require_fig" class="imageblock">
<div class="content">
<img src="./images/fig_07_02.png" alt="fig 07 02">
</div>
<div class="title">Figure 4. Unoptimized version of the Save The Child Application</div>
</div>
<div class="paragraph">
<p>The next <a href="#optim_with_rjs_fig">screenshot</a> shows loading of the Save The Child application optimized with RequireJS optimizer. We&#8217;ve managed to pack all our modules, their dependencies and loader&#8217;s code into a single file, which considerably decreased the number of the server-side calls.</p>
</div>
<div id="optim_with_rjs_fig" class="imageblock">
<div class="content">
<img src="./images/fig_07_03.png" alt="fig 07 03">
</div>
<div class="title">Figure 5. Loading of optimized version of the Save The Child</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Read more on optimization topics in the RequireJS documentation site under <a href="http://requirejs.org/docs/optimization.html">&#8220;Optimization&#8221;</a> section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>RequireJS took care of the optimal module loading, but you should properly arrange the inter-module communication. The Save The Child application doesn&#8217;t have modules that heed to exchange data so we&#8217;ll describe how to properly arrange inter-module communications in a separate application.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Google has created <a href="https://developers.google.com/speed/pagespeed/insights/">PageSpeed Insights</a>, a Web tool that offers suggestions for improving the performance of your Web application on all devices. Just enter the URL of your application and a second later you&#8217;ll see some optimization suggestions.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mediator_section">Loosely-Coupled Inter-Module Communications With Mediator</h3>
<div class="paragraph">
<p>Almost any complex enterprise Web application consists of a number of components and modules.</p>
</div>
<div class="paragraph">
<p>A simple approach of arranging communications between the components is to allow all these components directly accessing public properties of each other. This would produce an application with tightly coupled components that know about each other and removal of one component could lead to multiple code changes in the application.</p>
</div>
<div class="paragraph">
<p>A better approach is to create loosely coupled components that are self-contained, do not know about one another and can communicate with the "outside world" by sending and receiving events.</p>
</div>
<div class="paragraph">
<p>Creating UI of from reusable components applying messaging techniques requires creation of loosely coupled components. Say you&#8217;ve created a window for a financial trader. This window gets a data push from the server showing the latest stock prices. When the trader likes the price he may click on the Buy or Sell button to initiate a trade. The trading engine can be implemented in a separate component  and establishing inter-component communications the right way is really important.</p>
</div>
<div class="paragraph">
<p>As you&#8217;ve learned from Chapter 2, <em>Mediator</em> is a behavioral design pattern that allows to unify communications of the application components. The Mediator pattern promotes the use of a single shared object that handles (mediates) communication between other objects. None of the components is aware of the others, but each of them knows about a single object - the mediator.</p>
</div>
<div class="paragraph">
<p>In Chapter 2 we&#8217;ve introduced an example of a small fragment of a trader&#8217;s desktop. Let&#8217;s reuse the same example, but this time not with <code>postMessage</code> but with the Mediator object.</p>
</div>
<div class="paragraph">
<p>In Figure <a href="#FIG7-6">Before the trader clicked on the Price Panel</a>, the Pricing Panel on the left gets the data feed about the current prices of the IBM stock. When the user clicks on Bid or Ask button, the Pricing Panel just sends the event with the relevant trade information, e.g. a JSON-formatted string containing the stock symbol, price, buy or sell flag, date, etc.</p>
</div>
<div id="FIG7-6" class="imageblock">
<div class="content">
<img src="./images/fig_07_06.png" alt="fig 07 06">
</div>
<div class="title">Figure 6. Before the trader clicked on the Price Panel</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/fig_07_07.png" alt="fig 07 07">
</div>
<div class="title">Figure 7. After the trader clicked on the Price Panel</div>
</div>
<div class="paragraph">
<p>Here is a HTML code snipped that implements the above scenario.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="html language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;title&gt;An example of Mediator Design Pattern&lt;/title&gt;
    &lt;script data-main="app/config" src="bower_components/requirejs/require.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;mediator and RequireJS example&lt;/h1&gt;

    &lt;div id="pricePanel"&gt;       <i class="conum" data-value="1"></i><b>(1)</b>
        &lt;p&gt;IBM&lt;/p&gt;
        &lt;label for="priceInput"&gt;Bid:&lt;/label&gt;
        &lt;input type="text" id="priceInput" placeholder="bid price"/&gt;

        &lt;label for="priceInput"&gt;Ask:&lt;/label&gt;
        &lt;input type="text" id="priceInput" placeholder="bid price"/&gt;
    &lt;/div&gt;
    &lt;div id="orderPanel"&gt;       <i class="conum" data-value="2"></i><b>(2)</b>
        &lt;p id="priceText"&gt;&lt;/p&gt;
        &lt;label for="quantityInput"&gt;Quantity:&lt;/label&gt;
        &lt;input type="text" id="quantityInput" placeholder=""/&gt;
        &lt;button id="goButton"&gt;Go!&lt;/button&gt;
        &lt;button id="cancelButton"&gt;cancel&lt;/button&gt;
    &lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This <code>div</code> element contains <em>Pricing Panel</em> with Bid and Ask controls.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This <code>div</code> element contains <em>Order Panel</em> with Quantity, Go and Cancel controls.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As we stated before, we need a Mediator to handle communication between the application components. The components need to register themselves with the  Mediator so it knows about them and can route communications. The following snippet is a sample  Mediator implementation (we use <code>define</code> and <code>require</code> from RequireJS here).</p>
</div>
<div id="mediator_impl" class="listingblock">
<div class="title">The implementation of Mediator pattern.</div>
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">define(function() {
    "use strict";
    return (function() {    <i class="conum" data-value="1"></i><b>(1)</b>
        var components = {};

        function Mediator() {}

        Mediator.registerComponent = function(name, component) { <i class="conum" data-value="2"></i><b>(2)</b>
            var cmp;
            for (cmp in components) {
                if (components[cmp] === component) {
                    break;
                }
            }
            component.setMediator(Mediator);            <i class="conum" data-value="3"></i><b>(3)</b>
            components[name] = component;               <i class="conum" data-value="4"></i><b>(4)</b>
        };

        Mediator.broadcast = function(event, args, source) {    <i class="conum" data-value="5"></i><b>(5)</b>
            var cmp;
            if (!event) {
                return;
            }
            args = args || [];
            for (cmp in components) {
                if (typeof components[cmp]["on" + event] === "function") {      <i class="conum" data-value="6"></i><b>(6)</b>
                    source = source || components[cmp];
                    components[cmp]["on" + event].apply(source, args);
                }
            }
        };
        return Mediator;
    })();
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Return the private object that stores registered components.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>With the <code>Mediator.register()</code> function we can store components in the associative array. The Mediator is a singleton object here.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Assigning the mediator instance to the component being registered.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Registering component in the array using  provided <code>name</code> as key.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The component can invoke <code>Mediator.broadcast()</code> when it has some information to share with other  application components.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>If a component has a function property with the  name matching the pattern <code>"on" + event</code>, e.g. <code>onClickEvent</code>, the Mediator will invoke this function in the context of <code>source</code> object.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following code sample shows the main entry point of the application that uses the above mediator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">define(["mediator", "pricePanel", "orderPanel"], function(Mediator, PricePanel, OrderPanel) {   <i class="conum" data-value="1"></i><b>(1)</b>
    "use strict";
    return (function() {
        Mediator.registerComponent("pricePanel", new PricePanel());     <i class="conum" data-value="2"></i><b>(2)</b>
        Mediator.registerComponent("orderPanel", new OrderPanel());

        document.getElementById("priceInput").addEventListener("click", function() {   <i class="conum" data-value="3"></i><b>(3)</b>
            if ( !! this.value) {
                return Mediator.broadcast("BidClick", [this.value]);     <i class="conum" data-value="4"></i><b>(4)</b>
            }
        });

    })();
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Required modules will be loaded by RequireJS.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Registering our components with the Mediator.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Adding the <code>click</code> event listener for the Bid Price component.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>When the user clicks on the bid price the Mediator will broadcast the <code>BidClick</code> event to all registered component. Only the component that has this specific event handler with the name matching  the pattern <code>"on" + event</code> will receive this event.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s see how the code of the <code>PricePanel</code> and <code>OrderPanel</code> components looks like.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">define(function() {
    "use strict";
    return (function() {
        var mediator;

        function PricePanel() {
        }

        PricePanel.prototype.setMediator = function(m) {    <i class="conum" data-value="1"></i><b>(1)</b>
            mediator = m;
        };

        PricePanel.prototype.getMediator = function() {     <i class="conum" data-value="2"></i><b>(2)</b>
            return mediator;
        };

        PricePanel.prototype.onBidClick = function(currentPrice) {      <i class="conum" data-value="3"></i><b>(3)</b>
            console.log("Bid clicked on price " + currentPrice);
            this.getMediator().broadcast("PlaceBid", [currentPrice]);
        };

        PricePanel.prototype.onAskClick = function() {      <i class="conum" data-value="4"></i><b>(4)</b>
            console.log("Ask clicked");
        };

        return PricePanel;
    })();
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The setter of the Mediator object. Mediator injects its' instance during component registration (refer to <a href="#mediator_impl">The implementation of Mediator pattern.</a> snippet).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The getter of the Mediator object.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>onBidClick</code> event handler. The Mediator will call this function when the <code>BidClick</code> event will be broadcast. Using getter <code>getMediator</code> we can broadcast <code>PlaceBid</code> event to all registered components.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">define(function () {
    "use strict";
    return (function () {
        var mediator;

        function OrderPanel() {
        }

        OrderPanel.prototype.getMediator = function () {      <i class="conum" data-value="1"></i><b>(1)</b>
            return mediator;
        };

        OrderPanel.prototype.setMediator = function (m) {
            mediator = m;
        };

        OrderPanel.prototype.onPlaceBid = function (price) {     <i class="conum" data-value="2"></i><b>(2)</b>
            console.log("price updated to " + price);
            var priceTextElement = document.getElementById("priceText");
            priceTextElement.value = price;
        };

        return OrderPanel;

    })();
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The Mediator&#8217;s getter and setter have the purpose similar to described in previous snippet.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Defining the <code>PlaceBid</code> event handler - <code>onPlaceBid()</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you noticed, both <code>OrderPanel</code> and <code>PricePanel</code> don&#8217;t know about the existence of each other, but nevertheless they can sent and receive data with the help of intermediary - the Mediator object.</p>
</div>
<div class="paragraph">
<p>The introduction of the Mediator increases reusability of components by decoupling them from each other. The Mediator pattern simplifies the maintenance of any application by centralizing the  navigational logic.</p>
</div>
</div>
<div class="sect2">
<h3 id="_summary">Summary</h3>
<div class="paragraph">
<p>The size of any application tends to increase with time, and sooner or later you&#8217;ll need to decide how to cut it into several loadable blocks of functionality. The sooner you start modularizing your application the better.</p>
</div>
<div class="paragraph">
<p>In this chapter we&#8217;ve reviewed several options available for writing modular JavaScript using modern module formats. These formats have a number of advantages over using just the classical  Module Pattern. These advantages include avoiding creating global variables for each module and better support for static and dynamic dependency management.</p>
</div>
<div class="paragraph">
<p>Understanding various technologies and frameworks available in JavaScript, combined with the knowledge of different ways of linking modules and libraries is crucial for developers who want their JavaScript applications to be more responsive.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2013-12-18 17:12:38 EST
</div>
</div>
</body>
</html>